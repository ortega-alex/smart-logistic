import{r as n,j as e,v as V,aB as O}from"./index-DeRs25tb.js";import{B as h,I as j}from"./Icon-ZCyfFCep.js";import{E as P,V as $}from"./ViewFiles-DzOlCPbT.js";import{S as M}from"./Search-DWezstAv.js";import{h as L,s as u}from"./method-http.utility-CuofCWHh.js";import{b as R,c as B,d as G,e as U}from"./customer.service-C0Zt9a2E.js";import{V as m}from"./Utilityes.d-EXBqBskY.js";import{p as J,n as K,a as H,m as Q}from"./validation.utility-CXE8Ejlf.js";import{h as W}from"./type-of-customer.service-BInjdCXV.js";import{F as l}from"./index-C8MC8u8w.js";import{I as x}from"./index-gyB3Elxo.js";import{S as X,F as Y}from"./Table-B2h2cI4i.js";import{T as Z}from"./index-CT66_cbr.js";import{U as ee}from"./index-BnQTAwiB.js";import{S as te}from"./index-CTn83WAl.js";import{L as se}from"./index-JgT2oeId.js";import{M as E}from"./index-CWRTqrJg.js";import{P as re}from"./fuctions.utility-D0ENTGxM.js";import"./row-Dx3yH235.js";import"./progress-D11ttJlT.js";import"./Private-Bb13mkBg.js";const ie="/customer-file",ae=async p=>await L({path:`${ie}/${p}`,method:"DELETE"}),oe=({customer:p,onClose:g})=>{const[y,b]=n.useState(!1),[N,v]=n.useState([]),a=async(s,r,C=!0)=>{let c=null;if(C&&(!r||r.trim()==="")&&(c="El campo es obligatorio"),r&&r.trim()!==""&&(s===m.PhoneNumber&&(c=await J(r)),s===m.Nit&&(c=await K(r)),s===m.Dpi&&(c=await H(r)),s===m.Mail&&(c=await Q(r))),c)throw new Error(c)},w=async s=>{try{b(!0);let r;p.id_cliente>0?r=await R({...p,...s}):r=await B(s),r.message?u.warning(r.message):g()}catch(r){u.error(`Error http customer: ${r.message}`)}finally{b(!1)}};return n.useEffect(()=>{W().then(s=>v(s)).catch(s=>u.error(`Error http customer: ${s.message}`))},[]),e.jsxs(l,{layout:"vertical",initialValues:{...p,archivos:void 0},onFinish:w,children:[e.jsx(l.Item,{label:"Nombre completo",name:"cliente",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(x,{placeholder:"Ingrese el nombre del cliente"})}),e.jsx(l.Item,{label:"Tipo de cliente",name:"id_tipo_cliente",className:"flex-1",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(X,{placeholder:"Seleccione una opción",options:N.map(s=>({value:s.id_tipo_cliente,label:s.tipo_cliente}))})}),e.jsxs("div",{className:"flex flex-md-column justify-between gap-1",children:[e.jsx(l.Item,{label:"Teléfono Celular",name:"telefono_celular",className:"flex-1",rules:[{required:!0,validator:(s,r)=>a(m.PhoneNumber,r)}],children:e.jsx(x,{placeholder:"Ingrese un número de teléfono"})}),e.jsx(l.Item,{label:"Teléfono Fijo",name:"telefono_fijo",className:"flex-1",rules:[{required:!1,validator:(s,r)=>a(m.PhoneNumber,r,!1)}],children:e.jsx(x,{placeholder:"Ingrese un número de teléfono"})})]}),e.jsx(l.Item,{label:"Dirección",name:"direccion",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(x.TextArea,{rows:3,placeholder:"Ingrese una direccion"})}),e.jsxs("div",{className:"flex flex-md-column justify-between gap-1",children:[e.jsx(l.Item,{label:"Dpi",name:"dpi",className:"flex-1",rules:[{required:!0,validator:(s,r)=>a(m.Dpi,r)}],children:e.jsx(x,{placeholder:"Ingrese un número de dpi"})}),e.jsx(l.Item,{label:"Nit",name:"nit",className:"flex-1",rules:[{required:!0,validator:(s,r)=>a(m.Nit,r)}],children:e.jsx(x,{placeholder:"Ingrese un número de nit"})})]}),e.jsxs("div",{className:"flex flex-md-column justify-between gap-1",children:[e.jsx(l.Item,{label:"Email",name:"correo",className:"flex-1",rules:[{required:!0,validator:(s,r)=>a(m.Mail,r)}],children:e.jsx(x,{placeholder:"Ingrese un email"})}),e.jsx(l.Item,{label:"Costo",name:"porcentaje_costo",className:"flex-1",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(Z,{className:"w-100",min:0,max:100,formatter:s=>`${s}%`})})]}),e.jsxs("div",{className:"flex flex-md-column justify-between gap-1",children:[e.jsx(l.Item,{name:"files",rules:[{required:p.id_cliente===0,message:"El campo es obligatorio"}],children:e.jsx(ee,{style:{width:300,border:"solid black 1px"},multiple:!0,accept:".pdf",customRequest:()=>{},onChange:s=>s.file.status="done",children:e.jsx(h,{type:"dashed",htmlType:"button",icon:e.jsx(j.Upload,{}),block:!0,children:"Archivos"})})}),e.jsx(l.Item,{name:"estado",label:"Estado",valuePropName:"checked",children:e.jsx(te,{checkedChildren:"Activo",unCheckedChildren:"Inactivo"})})]}),e.jsx("div",{className:"text-right",children:e.jsx(h,{type:"primary",htmlType:"submit",loading:y,disabled:y,children:"Enviar"})})]})},Se=()=>{var A,F;const p=V(t=>t.device),g="Clientes",[y,b]=n.useState(!1),[N,v]=n.useState([]),[a,w]=n.useState(O),[s,r]=n.useState({customer:!1,preview:!1}),[C,c]=n.useState(P),[d,_]=n.useState({pagination:{current:1,pageSize:250}}),[S,T]=n.useState(""),f=(t,i=!0)=>r({...s,[t]:i}),k=()=>{var t,i;b(!0),G({...d,current:(t=d.pagination)==null?void 0:t.current,pageSize:(i=d.pagination)==null?void 0:i.pageSize,filter:S,sortOrder:d.sortOrder==="descend"?"DESC":"ASC"}).then(o=>{v(o.data),_({...d,pagination:{...d.pagination,total:o.total}})}).catch(o=>u.error(`Error http get customers: ${o.message}`)).finally(()=>b(!1))},I=t=>{U(t.id_cliente).then(i=>{var o;i.message?u.warning(i.message):(w({...i,id_tipo_cliente:(o=t.tipo_cliente)==null?void 0:o.id_tipo_cliente}),f("customer"))}).catch(i=>u.error(`Error http get customer by id: ${i.message}`))},z=t=>{E.confirm({title:"Eliminar archivo",content:"Estas seguro de querer eliminar este archivo?",okText:"Si",cancelText:"No",onOk:()=>ae(t).then(i=>{u.info(i.message),I(a)}).catch(i=>u.error(`Error http delete customer file by id: ${i.message}`))})},D=(t,i,o)=>{var q;_({pagination:t,filters:i,sortOrder:Array.isArray(o)?void 0:o.order,sortField:Array.isArray(o)?void 0:o.field}),t.pageSize!==((q=d.pagination)==null?void 0:q.pageSize)&&v([])};return n.useEffect(()=>{k()},[JSON.stringify(d),S]),e.jsxs("div",{className:"h-100 flex flex-column p-3",children:[e.jsxs("div",{className:"flex flex-md-column gap-3 justify-between",children:[e.jsx("h3",{children:g}),e.jsx("div",{children:e.jsx(M,{onSearch:t=>T(t),onReset:()=>T("")})}),e.jsx(h,{type:"primary",htmlType:"button",onClick:()=>{w(O),f("customer")},children:"Agregar"})]}),p?e.jsx(se,{dataSource:N,renderItem:t=>{var i;return e.jsxs("div",{className:"item-list",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Nombre: "})," ",t.cliente]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Nombre: "})," ",(i=t.tipo_cliente)==null?void 0:i.tipo_cliente]}),e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Telefono: "})," ",t.telefono_celular]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Correo: "})," ",t.correo]})]}),e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Estado: "})," ",t.estado?"Activo":"Inactivo"]}),e.jsx(h,{type:"link",danger:!0,htmlType:"button",icon:e.jsx(j.Edit,{}),onClick:()=>I(t),children:"Editar"})]})]},t.id_cliente)}}):e.jsx(Y,{size:"small",rowClassName:(t,i)=>i%2===0?"table-row-light":"table-row-dark",pagination:{position:["none","bottomRight"],...d.pagination,showSizeChanger:!0,pageSizeOptions:[50,100,250,500]},onChange:D,className:"table",loading:y,showSorterTooltip:!1,rowKey:"id_cliente",dataSource:N,columns:[{title:"No",dataIndex:"id_cliente",sorter:!0},{title:"Nombre",dataIndex:"cliente",ellipsis:!0,sorter:!0},{title:"Tipo de Cliente",dataIndex:"tipo_cliente",ellipsis:!0,sorter:!0,render:t=>e.jsx("span",{children:t==null?void 0:t.tipo_cliente})},{title:"Telefono",dataIndex:"telefono_celular",sorter:!0},{title:"Correo",dataIndex:"correo",sorter:!0},{title:"Estado",dataIndex:"estado",render:t=>e.jsx("span",{className:t?"text-success":"text-danger",children:t?"Actuvi":"Inactivo"})},{title:"Opciones",dataIndex:"operacion",width:80,render:(t,i)=>e.jsx("div",{className:"text-center",children:e.jsx(h,{style:{width:40},icon:e.jsx(j.Edit,{}),type:"primary",size:"small",onClick:()=>I(i)})})}]}),e.jsx(E,{open:s.customer,footer:null,title:e.jsxs("div",{className:"flex flex-row gap-1",children:[(a==null?void 0:a.archivos)&&((A=a.archivos)==null?void 0:A.length)>0&&e.jsx(re,{placement:"bottomLeft",content:e.jsx(e.Fragment,{children:(F=a.archivos)==null?void 0:F.map(t=>e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx(h,{type:"link",size:"small",icon:e.jsx(j.Attachment,{}),onClick:()=>{c(t),f("preview")},children:t.nombre}),e.jsx(h,{size:"small",type:"text",htmlType:"button",danger:!0,ghost:!0,icon:e.jsx(j.Trash,{}),onClick:()=>z(t.id_archivo)})]},t.id_archivo))}),children:e.jsx(h,{type:"link",htmlType:"button",ghost:!0,icon:e.jsx(j.Attachment,{}),children:"Archivos"})}),e.jsxs("h3",{className:"text-primary",children:[a.id_cliente>0?"Editar":"Nuevo"," ",g.substring(0,g.length-1)]})]}),onCancel:()=>f("customer",!1),centered:!0,destroyOnClose:!0,children:e.jsx(oe,{customer:a,onClose:()=>{f("customer",!1),k()}})}),e.jsx(E,{open:s.preview,footer:null,onCancel:()=>f("preview",!1),centered:!0,destroyOnClose:!0,children:e.jsx($,{file:C})})]})};export{Se as Customer};
