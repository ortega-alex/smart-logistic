import{m as K,b as k,r as m,C as ee,c as te,j as e,S as W,O as J}from"./index-BFyK-PPl.js";import{g as ae,m as re,N as F,B as N,I as D,s as E,T as oe}from"./method-http.utility-CnKrLNWY.js";import{M as P}from"./Utilityes.d-EXBqBskY.js";import{h as ie}from"./aution.service-QOCoDA4K.js";import{h as ne}from"./crane.service-DAGY9geO.js";import{c as $,h as se,g as le}from"./port.service-Cu6ALCrw.js";import{h as de}from"./customer.service-7FfCqoiq.js";import{h as ce}from"./type-vehicle.service-BW0gk01h.js";import{M as Z,S as M,L as ue,F as me}from"./Table-CamGxVxZ.js";import{F as b,I as Q}from"./index-B0oLdk95.js";import{T as he}from"./index-Bd7YEjNI.js";import"./Private-wVj_y8-q.js";const Y={id_cotizacion:0,id_cliente:0,id_vendedor:0,id_tipo_vehiculo:0,marca:"",modelo:"",anio:"",id_puerto:0,estado:!0},pe={nombre:"",valor:"",moneda:""};var I=(a=>(a.USD="Grua EE.UU",a.GTQ="Grua GT",a.PORT_SHIPPING="Embarque",a.PORT_DOCUMENT_OR_EXP="ADUANA Y DOCS. EXP",a))(I||{});const X={nombre:"",moneda:"",valor:0},xe=a=>{const{componentCls:o,sizePaddingEdgeHorizontal:h,colorSplit:i,lineWidth:c,textPaddingInline:_,orientationMargin:f,verticalMarginInline:x}=a;return{[o]:Object.assign(Object.assign({},K(a)),{borderBlockStart:`${k(c)} solid ${i}`,"&-vertical":{position:"relative",top:"-0.06em",display:"inline-block",height:"0.9em",marginInline:x,marginBlock:0,verticalAlign:"middle",borderTop:0,borderInlineStart:`${k(c)} solid ${i}`},"&-horizontal":{display:"flex",clear:"both",width:"100%",minWidth:"100%",margin:`${k(a.dividerHorizontalGutterMargin)} 0`},[`&-horizontal${o}-with-text`]:{display:"flex",alignItems:"center",margin:`${k(a.dividerHorizontalWithTextGutterMargin)} 0`,color:a.colorTextHeading,fontWeight:500,fontSize:a.fontSizeLG,whiteSpace:"nowrap",textAlign:"center",borderBlockStart:`0 ${i}`,"&::before, &::after":{position:"relative",width:"50%",borderBlockStart:`${k(c)} solid transparent`,borderBlockStartColor:"inherit",borderBlockEnd:0,transform:"translateY(50%)",content:"''"}},[`&-horizontal${o}-with-text-left`]:{"&::before":{width:`calc(${f} * 100%)`},"&::after":{width:`calc(100% - ${f} * 100%)`}},[`&-horizontal${o}-with-text-right`]:{"&::before":{width:`calc(100% - ${f} * 100%)`},"&::after":{width:`calc(${f} * 100%)`}},[`${o}-inner-text`]:{display:"inline-block",paddingBlock:0,paddingInline:_},"&-dashed":{background:"none",borderColor:i,borderStyle:"dashed",borderWidth:`${k(c)} 0 0`},[`&-horizontal${o}-with-text${o}-dashed`]:{"&::before, &::after":{borderStyle:"dashed none none"}},[`&-vertical${o}-dashed`]:{borderInlineStartWidth:c,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},"&-dotted":{background:"none",borderColor:i,borderStyle:"dotted",borderWidth:`${k(c)} 0 0`},[`&-horizontal${o}-with-text${o}-dotted`]:{"&::before, &::after":{borderStyle:"dotted none none"}},[`&-vertical${o}-dotted`]:{borderInlineStartWidth:c,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${o}-with-text`]:{color:a.colorText,fontWeight:"normal",fontSize:a.fontSize},[`&-horizontal${o}-with-text-left${o}-no-default-orientation-margin-left`]:{"&::before":{width:0},"&::after":{width:"100%"},[`${o}-inner-text`]:{paddingInlineStart:h}},[`&-horizontal${o}-with-text-right${o}-no-default-orientation-margin-right`]:{"&::before":{width:"100%"},"&::after":{width:0},[`${o}-inner-text`]:{paddingInlineEnd:h}}})}},fe=a=>({textPaddingInline:"1em",orientationMargin:.05,verticalMarginInline:a.marginXS}),ge=ae("Divider",a=>{const o=re(a,{dividerHorizontalWithTextGutterMargin:a.margin,dividerHorizontalGutterMargin:a.marginLG,sizePaddingEdgeHorizontal:0});return[xe(o)]},fe,{unitless:{orientationMargin:!0}});var be=function(a,o){var h={};for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&o.indexOf(i)<0&&(h[i]=a[i]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,i=Object.getOwnPropertySymbols(a);c<i.length;c++)o.indexOf(i[c])<0&&Object.prototype.propertyIsEnumerable.call(a,i[c])&&(h[i[c]]=a[i[c]]);return h};const q=a=>{const{getPrefixCls:o,direction:h,divider:i}=m.useContext(ee),{prefixCls:c,type:_="horizontal",orientation:f="center",orientationMargin:x,className:d,rootClassName:g,children:w,dashed:z,variant:r="solid",plain:u,style:y}=a,T=be(a,["prefixCls","type","orientation","orientationMargin","className","rootClassName","children","dashed","variant","plain","style"]),l=o("divider",c),[O,R,V]=ge(l),U=!!w,H=f==="left"&&x!=null,B=f==="right"&&x!=null,t=te(l,i==null?void 0:i.className,R,V,`${l}-${_}`,{[`${l}-with-text`]:U,[`${l}-with-text-${f}`]:U,[`${l}-dashed`]:!!z,[`${l}-${r}`]:r!=="solid",[`${l}-plain`]:!!u,[`${l}-rtl`]:h==="rtl",[`${l}-no-default-orientation-margin-left`]:H,[`${l}-no-default-orientation-margin-right`]:B},d,g),n=m.useMemo(()=>typeof x=="number"?x:/^\d+$/.test(x)?Number(x):x,[x]),p=Object.assign(Object.assign({},H&&{marginLeft:n}),B&&{marginRight:n});return O(m.createElement("div",Object.assign({className:t,style:Object.assign(Object.assign({},i==null?void 0:i.style),y)},T,{role:"separator"}),w&&_!=="vertical"&&m.createElement("span",{className:`${l}-inner-text`,style:p},w)))},je=(a,o)=>{const h=window.URL.createObjectURL(new Blob([a])),i=document.createElement("a");i.href=h,i.setAttribute("download",o),document.body.appendChild(i),i.click()},A="/quoter",ve=async()=>await F({path:A,method:"GET"}),_e=async a=>await F({path:`${A}/${a}`,method:"GET"}),ye=async a=>await F({path:A,method:"POST",data:a}),Se=async a=>await F({path:`${A}/${a.id_cotizacion}`,method:"PUT",data:a}),we=async a=>await F({path:`${A}/invoice/${a}`,method:"GET",responseType:"blob"}),Ie=({details:a,onSubmit:o})=>{const[h,i]=m.useState(X),[c,_]=m.useState(!1),f=async d=>{const g=[...a];g[h.index??0]={...d,valor:$(d.valor??"")},o(g),_(!1)},x=d=>e.jsx(e.Fragment,{children:d.map((g,w)=>e.jsxs("div",{className:"flex flex-row justify-between gap-3 items-center",children:[e.jsxs("strong",{className:"flex-1",children:[g.nombre,": "]}),e.jsx("span",{children:g.moneda}),e.jsx("span",{children:g.valor}),e.jsxs("div",{children:[e.jsx(N,{type:"link",htmlType:"button",size:"small",icon:e.jsx(D.Edit,{}),onClick:()=>{i({...g,index:w}),_(!0)}}),e.jsx(N,{danger:!0,type:"link",size:"small",htmlType:"button",icon:e.jsx(D.Trash,{}),onClick:()=>o(d.filter((z,r)=>r!==w))})]})]},w))});return e.jsxs(e.Fragment,{children:[e.jsx(q,{orientation:"left",children:"Costos USD"}),x(a.filter(d=>d.moneda===P.USD)),e.jsx(q,{orientation:"left",children:"Costos GTQ"}),x(a.filter(d=>d.moneda===P.GTQ)),e.jsx("div",{className:"text-right mt-3",children:e.jsx(N,{type:"primary",style:{color:W.secondary,borderColor:W.secondary},ghost:!0,size:"small",htmlType:"button",icon:e.jsx(D.Plus,{}),onClick:()=>{const d=[...a];d.push(pe),o(d),i({...X,index:d.length-1}),_(!0)},children:"Agregar"})}),e.jsx(Z,{open:c,onCancel:()=>_(!1),footer:null,title:"Editar",destroyOnClose:!0,children:e.jsxs(b,{layout:"vertical",initialValues:h,onFinish:f,children:[e.jsx(b.Item,{label:"Titulo",name:"nombre",rules:[{required:!0,message:"El campo es requerido"}],children:e.jsx(Q,{placeholder:"Ingrese un titulo"})}),e.jsx(b.Item,{label:"Moneda",name:"moneda",rules:[{required:!0,message:"El campo es requerido"}],children:e.jsx(M,{allowClear:!0,className:"w-100",placeholder:"Selecciones una opción",options:Object.keys(P).map(d=>({label:d,value:P[d]}))})}),e.jsx(b.Item,{label:"Valor",name:"valor",rules:[{required:!0,message:"El campo es requerido"}],children:e.jsx(he,{placeholder:"Ingrese un valor",className:"w-100",formatter:d=>$(d??"")})}),e.jsx("div",{className:"text-right mt-3",children:e.jsx(N,{type:"primary",htmlType:"submit",children:"Guardar"})})]})})]})},Ne=({quoter:a,onClose:o})=>{var B;const h=m.useRef(null),i=J(t=>t.session),[c,_]=m.useState([]),[f,x]=m.useState([]),[d,g]=m.useState([]),[w,z]=m.useState([]),[r,u]=m.useState({USD:[],GTQ:[],all:[]}),[y,T]=m.useState(!1),[l,O]=m.useState([]),R=t=>{var G;const[n,p]=Object.entries(t)[0];if(n==="id_subasta"){const j=r.all.filter(s=>{var v;return((v=s.subasta)==null?void 0:v.id_subasta)===p&&s.estado});j&&u({...r,USD:j}),(G=h.current)==null||G.setFieldValue("id_grua_usd",void 0)}V()},V=()=>{var n;const t=(n=h.current)==null?void 0:n.getFieldsValue();if(t&&t.id_cliente){let p=[...l];const G=c.find(s=>s.id_cliente===t.id_cliente),j=f.find(s=>s.id_puerto===t.id_puerto);if(j){const s=l.findIndex(S=>S.nombre===I.PORT_DOCUMENT_OR_EXP);if(s>-1){const S=l[s];S.valor=$(j.costo_aduanal)}else p.push({nombre:I.PORT_DOCUMENT_OR_EXP,moneda:P.USD,valor:$(j.costo_aduanal)});const v=d.find(S=>S.id_tipo_vehiculo===t.id_tipo_vehiculo);if(v){const S=l.findIndex(L=>L.nombre===I.PORT_SHIPPING),C=Number(j.costo_embarque)+Number(j.costo_embarque)*(Number(v.porcentaje_costo)/100);if(S>-1){const L=l[S];L.valor=$(C)}else p.push({nombre:I.PORT_SHIPPING,moneda:P.USD,valor:$(C)})}}if(G){if(t.id_grua_usd){const s=r.USD.find(v=>v.id_grua===t.id_grua_usd);if(s&&s.costo>0){const v=Number(s.costo)+Number(s.costo)*(Number(G.porcentaje_costo)/100),S=l.findIndex(C=>C.nombre===I.USD);if(S>-1){const C=l[S];C.valor=$(v)}else p.push({nombre:I.USD,moneda:s.moneda,valor:$(v)})}}else p=p.filter(s=>s.nombre!==I.USD);if(t.id_grua_gt){const s=r.GTQ.find(v=>v.id_grua===t.id_grua_gt);if(s&&s.costo>0){const v=Number(s.costo)+Number(s.costo)*(Number(G.porcentaje_costo)/100),S=l.findIndex(C=>C.nombre===I.GTQ);if(S>-1){const C=l[S];C.valor=$(v)}else p.push({nombre:I.GTQ,moneda:s.moneda,valor:$(v)})}}else p=p.filter(s=>s.nombre!==I.GTQ)}O(p)}},U=async()=>{T(!0),we(a.id_cotizacion).then(t=>{var n;return je(t,`${((n=a.cliente)==null?void 0:n.cliente)??"cotizacion"}-invoice.zip`)}).catch(t=>E.error(`Error http download invoice: ${t.message}`)).finally(()=>T(!1))},H=async t=>{try{T(!0);let n;const p={...a,...t,detalles:l};a.id_cotizacion===0?n=await ye({...p,id_vendedor:i.id_sesion}):n=await Se(p),n.message?E.warning(n.message):o()}catch(n){E.error(`Error add or edit ouoter: ${n.message}`)}finally{T(!1)}};return m.useEffect(()=>{a.details&&O(a.details),console.log(a),de().then(t=>_(t==null?void 0:t.filter(n=>n.estado))).catch(t=>E.error(`Error http get customers: ${t.message}}`)),se().then(t=>x(t==null?void 0:t.filter(n=>n.estado))).catch(t=>E.error(`Error http get ports: ${t.message}}`)),ce().then(t=>g(t==null?void 0:t.filter(n=>n.estado))).catch(t=>E.error(`Error http get type of vehicles: ${t.message}}`)),ie().then(t=>z(t==null?void 0:t.filter(n=>n.estado))).catch(t=>E.error(`Error http get autions: ${t.message}}`)),ne().then(t=>{const n=t==null?void 0:t.filter(j=>j.estado),p=n==null?void 0:n.filter(j=>j.moneda===P.GTQ),G=n==null?void 0:n.filter(j=>{var s;return j.moneda===P.USD&&((s=j.subasta)==null?void 0:s.id_subasta)===a.id_subasta});u({...r,GTQ:p,all:n,USD:G})}).catch(t=>E.error(`Error http get cranes: ${t.message}}`))},[]),e.jsx(e.Fragment,{children:e.jsxs(b,{ref:h,initialValues:a.id_cotizacion===0?{}:a,layout:"vertical",onFinish:H,onValuesChange:R,children:[e.jsx("div",{className:"vhm-75 overflow-y",children:e.jsxs("div",{className:"flex flex-md-column justify-between",children:[e.jsxs("div",{className:"flex-1 p-3",children:[e.jsx(q,{orientation:"left",children:"Información del Cliente/Puerto"}),e.jsx(b.Item,{label:"Cliente",name:"id_cliente",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(M,{className:"w-100",placeholder:"Selecciones una opción",options:c.map(t=>({label:t.cliente,value:t.id_cliente}))})}),e.jsx(b.Item,{label:"Puerto",name:"id_puerto",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(M,{className:"w-100",placeholder:"Selecciones una opción",options:f.map(t=>({label:t.puerto,value:t.id_puerto}))})}),e.jsx(q,{orientation:"left",children:"Información del vehículo"}),e.jsxs("div",{className:"flex flex-md-column gap-3 justify-between item-end",children:[e.jsx(b.Item,{label:"Tipo de Vehículo",name:"id_tipo_vehiculo",rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:e.jsx(M,{className:"w-100",placeholder:"Selecciones una opción",options:d.map(t=>({label:t.tipo_vehiculo,value:t.id_tipo_vehiculo}))})}),e.jsx(b.Item,{label:"Año",name:"anio",rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:e.jsx(Q,{placeholder:"Ingrese un año"})})]}),e.jsxs("div",{className:"flex flex-md-column gap-3 justify-between item-end",children:[e.jsx(b.Item,{label:"Marca",name:"marca",rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:e.jsx(Q,{placeholder:"Ingrese una Marca"})}),e.jsx(b.Item,{label:"Modelo",name:"modelo",rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:e.jsx(Q,{placeholder:"Ingrese un Modelo"})})]}),e.jsxs("div",{className:"flex flex-md-column gap-3 justify-between item-end",children:[e.jsx(b.Item,{label:"Serie",name:"serie",rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:e.jsx(Q,{placeholder:"Ingrese una Serie"})}),e.jsx(b.Item,{label:"VIN",name:"vin",rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:e.jsx(Q,{placeholder:"Ingrese un VIN"})})]})]}),e.jsxs("div",{className:"flex-1 p-3",children:[e.jsx(q,{orientation:"left",children:"Tramites EE. UU"}),e.jsx(b.Item,{label:"Subasta (optional)",name:"id_subasta",children:e.jsx(M,{allowClear:!0,className:"w-100",placeholder:"Selecciones una opción",options:w.map(t=>({label:t.subasta,value:t.id_subasta}))})}),e.jsx(b.Item,{label:"Grua (optional)",name:"id_grua_usd",children:e.jsx(M,{allowClear:!0,className:"w-100",placeholder:"Selecciones una opción",options:(B=r.USD)==null?void 0:B.map(t=>({label:t.grua,value:t.id_grua}))})}),e.jsx(q,{orientation:"left",children:"Tramites GT"}),e.jsx(b.Item,{label:"Grua (optional)",name:"id_grua_gt",children:e.jsx(M,{allowClear:!0,className:"w-100",placeholder:"Selecciones una opción",options:r.GTQ.map(t=>({label:t.grua,value:t.id_grua}))})}),e.jsx(Ie,{details:l,onSubmit:O})]})]})}),e.jsxs("div",{className:"flex flex-row justify-end gap-2",children:[e.jsx(N,{type:"text",htmlType:"button",loading:y,disabled:y||a.id_cotizacion===0,danger:!0,icon:e.jsx(D.FilePdf,{}),onClick:()=>U(),children:"Imprimir"}),e.jsx(N,{type:"text",htmlType:"button",loading:y,disabled:y||a.id_cotizacion===0,icon:e.jsx(D.EMail,{}),children:"Correo"}),e.jsx(N,{type:"primary",htmlType:"submit",loading:y,disabled:y,children:"Guardar"})]})]})})},Qe=()=>{const a=J(r=>r.device),[o,h]=m.useState([]),[i,c]=m.useState(Y),[_,f]=m.useState(!1),[x,d]=m.useState({form:!1,preview:!1}),g=(r,u=!0)=>d({[r]:u}),w=r=>{_e(r).then(u=>{var y,T,l,O,R,V,U;c({...u,id_cliente:(y=u.cliente)==null?void 0:y.id_cliente,id_vendedor:(T=u.vendedor)==null?void 0:T.id_usuario,id_tipo_vehiculo:(l=u.tipo_veniculo)==null?void 0:l.id_tipo_vehiculo,id_puerto:(O=u.puerto)==null?void 0:O.id_puerto,id_subasta:(R=u.subasta)==null?void 0:R.id_subasta,id_grua_usd:(V=u.grua_usd)==null?void 0:V.id_grua,id_grua_gt:(U=u.grua_gt)==null?void 0:U.id_grua}),g("form")}).catch(u=>E.error(`Error http get quoters: ${u.message}`))},z=()=>{f(!0),ve().then(r=>h(r)).catch(r=>E.error(`Error http get quoters: ${r.message}`)).finally(()=>f(!1))};return m.useEffect(()=>{z()},[]),e.jsxs("div",{className:"h-100 flex flex-column p-3",children:[e.jsxs("div",{className:"flex flex-md-column gap-3 justify-between items-end",children:[e.jsxs("div",{className:"flex flex-column",children:[e.jsx("label",{htmlFor:"cliente",children:"Cliente"}),e.jsx(M,{placeholder:"Seleccione una opcion"})]}),e.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[e.jsx(oe,{title:"Recargar",children:e.jsx(N,{type:"text",htmlType:"button",icon:e.jsx(D.Reload,{}),onClick:()=>z()})}),e.jsx(Q.Search,{placeholder:"Buscar",onSearch:()=>{},enterButton:!0})]}),e.jsx(N,{type:"primary",htmlType:"button",onClick:()=>{c(Y),g("form")},children:"Agregar"})]}),a?e.jsx(ue,{dataSource:o,loading:_,renderItem:r=>{var u,y;return e.jsxs("div",{className:"item-list",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Cliente: "})," ",(u=r.cliente)==null?void 0:u.cliente]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Vendedor: "})," ",(y=r.vendedor)==null?void 0:y.nombre]}),e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Estado: "})," ",r.estado?"Activo":"Inactivo"]}),e.jsx(N,{type:"link",danger:!0,htmlType:"button",icon:e.jsx(D.Edit,{}),onClick:()=>w(r.id_cotizacion),children:"Editar"})]})]},r.id_cotizacion)}}):e.jsx(me,{size:"small",rowClassName:(r,u)=>u%2===0?"table-row-light":"table-row-dark",pagination:{position:["none","bottomRight"],showSizeChanger:!0,pageSizeOptions:[50,100,250,500]},className:"table",loading:_,showSorterTooltip:!1,rowKey:"id_cotizacion",dataSource:o,columns:[{title:"No",dataIndex:"id_cotizacion"},{title:"Fecha",dataIndex:"fecha_creacion",ellipsis:!0,sorter:!0,render:r=>e.jsx("span",{children:le(r,"DD/MM/YYYY")})},{title:"Vendedor",dataIndex:"vendedor",ellipsis:!0,sorter:!0,render:r=>e.jsx("span",{children:r.nombre})},{title:"Cliente",dataIndex:"cliente",ellipsis:!0,sorter:!0,render:r=>e.jsx("span",{children:r.cliente})},{title:"Marca",dataIndex:"marca",ellipsis:!0,sorter:!0},{title:"Modelo",dataIndex:"modelo",ellipsis:!0,sorter:!0},{title:"Estado",dataIndex:"estado",render:r=>e.jsx("span",{className:r?"text-success":"text-danger",children:r?"Activo":"Inactivo"})},{title:"Opciones",dataIndex:"operacion",width:80,render:(r,u)=>e.jsx("div",{className:"text-center",children:e.jsx(N,{style:{width:40},icon:e.jsx(D.Edit,{}),type:"primary",size:"small",onClick:()=>w(u.id_cotizacion)})})}]}),e.jsx(Z,{open:x.form,title:e.jsxs("h3",{children:[i.id_cotizacion>0?"Editar":"Agregar"," Cotización"]}),footer:null,onCancel:()=>g("form",!1),centered:!0,destroyOnClose:!0,width:1200,children:e.jsx(Ne,{quoter:i,onClose:()=>{z(),g("form",!1)}})})]})};export{Qe as Quoter};
