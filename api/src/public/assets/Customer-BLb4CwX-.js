import{r as n,j as e,q as V,aY as O}from"./index-BKeSh-za.js";import{h as P,s as u,B as h,I as j}from"./method-http.utility-BqWs-HUi.js";import{E as $,V as M}from"./ViewFiles-DAXJi2L_.js";import{a as L,c as R,d as G,e as B}from"./customer.service-CpYLP9T3.js";import{S as U}from"./Search-C06RTD8T.js";import{V as m}from"./Utilityes.d-EXBqBskY.js";import{p as J,n as K,a as Y,m as H}from"./Private--lMmMBfU.js";import{h as Q}from"./type-of-customer.service-QlxL3xbh.js";import{F as o}from"./index-D1ov7vNX.js";import{I as x}from"./index-CdhWyq-o.js";import{S as W,F as X}from"./Table-BisBHS4k.js";import{T as Z}from"./index-O4SDTvlh.js";import{U as ee}from"./index-__oWxrm-.js";import{S as te}from"./index-Cz9KrAQ8.js";import{L as se}from"./index-CvXNAYlc.js";import{M as E}from"./index-DR3JyN9M.js";import{P as re}from"./Notification-BCtfLTOT.js";import"./user.service-DGdalJkS.js";import"./row-xrRCuAxq.js";import"./DownOutlined-uChH8jli.js";import"./fade-CQfhyCPf.js";import"./progress-BDO-QPZc.js";const ie="/customer-file",ae=async p=>await P({path:`${ie}/${p}`,method:"DELETE"}),le=({customer:p,onClose:g})=>{const[y,b]=n.useState(!1),[N,w]=n.useState([]),a=async(s,r,v=!0)=>{let c=null;if(v&&(!r||r.trim()==="")&&(c="El campo es obligatorio"),r&&r.trim()!==""&&(s===m.PhoneNumber&&(c=await J(r)),s===m.Nit&&(c=await K(r)),s===m.Dpi&&(c=await Y(r)),s===m.Mail&&(c=await H(r))),c)throw new Error(c)},C=async s=>{try{b(!0);let r;p.id_cliente>0?r=await L({...p,...s}):r=await R(s),r.message?u.warning(r.message):g()}catch(r){u.error(`Error http customer: ${r.message}`)}finally{b(!1)}};return n.useEffect(()=>{Q().then(s=>w(s)).catch(s=>u.error(`Error http customer: ${s.message}`))},[]),e.jsxs(o,{layout:"vertical",initialValues:{...p,archivos:void 0},onFinish:C,children:[e.jsx(o.Item,{label:"Nombre completo",name:"cliente",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(x,{placeholder:"Ingrese el nombre del cliente"})}),e.jsx(o.Item,{label:"Tipo de cliente",name:"id_tipo_cliente",className:"flex-1",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(W,{placeholder:"Seleccione una opción",options:N.map(s=>({value:s.id_tipo_cliente,label:s.tipo_cliente}))})}),e.jsxs("div",{className:"flex flex-md-column justify-between gap-1",children:[e.jsx(o.Item,{label:"Teléfono Celular",name:"telefono_celular",className:"flex-1",rules:[{required:!0,validator:(s,r)=>a(m.PhoneNumber,r)}],children:e.jsx(x,{placeholder:"Ingrese un número de teléfono"})}),e.jsx(o.Item,{label:"Teléfono Fijo",name:"telefono_fijo",className:"flex-1",rules:[{required:!1,validator:(s,r)=>a(m.PhoneNumber,r,!1)}],children:e.jsx(x,{placeholder:"Ingrese un número de teléfono"})})]}),e.jsx(o.Item,{label:"Dirección",name:"direccion",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(x.TextArea,{rows:3,placeholder:"Ingrese una direccion"})}),e.jsxs("div",{className:"flex flex-md-column justify-between gap-1",children:[e.jsx(o.Item,{label:"Dpi",name:"dpi",className:"flex-1",rules:[{required:!0,validator:(s,r)=>a(m.Dpi,r)}],children:e.jsx(x,{placeholder:"Ingrese un número de dpi"})}),e.jsx(o.Item,{label:"Nit",name:"nit",className:"flex-1",rules:[{required:!0,validator:(s,r)=>a(m.Nit,r)}],children:e.jsx(x,{placeholder:"Ingrese un número de nit"})})]}),e.jsxs("div",{className:"flex flex-md-column justify-between gap-1",children:[e.jsx(o.Item,{label:"Email",name:"correo",className:"flex-1",rules:[{required:!0,validator:(s,r)=>a(m.Mail,r)}],children:e.jsx(x,{placeholder:"Ingrese un email"})}),e.jsx(o.Item,{label:"Costo",name:"porcentaje_costo",className:"flex-1",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(Z,{className:"w-100",min:0,max:100,formatter:s=>`${s}%`})})]}),e.jsxs("div",{className:"flex flex-md-column justify-between gap-1",children:[e.jsx(o.Item,{name:"files",rules:[{required:p.id_cliente===0,message:"El campo es obligatorio"}],children:e.jsx(ee,{style:{width:300,border:"solid black 1px"},multiple:!0,accept:".pdf",customRequest:()=>{},onChange:s=>s.file.status="done",children:e.jsx(h,{type:"dashed",htmlType:"button",icon:e.jsx(j.Upload,{}),block:!0,children:"Archivos"})})}),e.jsx(o.Item,{name:"estado",label:"Estado",valuePropName:"checked",children:e.jsx(te,{checkedChildren:"Activo",unCheckedChildren:"Inactivo"})})]}),e.jsx("div",{className:"text-right",children:e.jsx(h,{type:"primary",htmlType:"submit",loading:y,disabled:y,children:"Enviar"})})]})},Te=()=>{var A,F;const p=V(t=>t.device),g="Clientes",[y,b]=n.useState(!1),[N,w]=n.useState([]),[a,C]=n.useState(O),[s,r]=n.useState({customer:!1,preview:!1}),[v,c]=n.useState($),[d,_]=n.useState({pagination:{current:1,pageSize:250}}),[S,T]=n.useState(""),f=(t,i=!0)=>r({...s,[t]:i}),k=()=>{var t,i;b(!0),G({...d,current:(t=d.pagination)==null?void 0:t.current,pageSize:(i=d.pagination)==null?void 0:i.pageSize,filter:S,sortOrder:d.sortOrder==="descend"?"DESC":"ASC"}).then(l=>{w(l.data),_({...d,pagination:{...d.pagination,total:l.total}})}).catch(l=>u.error(`Error http get customers: ${l.message}`)).finally(()=>b(!1))},I=t=>{B(t.id_cliente).then(i=>{var l;i.message?u.warning(i.message):(C({...i,id_tipo_cliente:(l=t.tipo_cliente)==null?void 0:l.id_tipo_cliente}),f("customer"))}).catch(i=>u.error(`Error http get customer by id: ${i.message}`))},z=t=>{E.confirm({title:"Eliminar archivo",content:"Estas seguro de querer eliminar este archivo?",okText:"Si",cancelText:"No",onOk:()=>ae(t).then(i=>{u.info(i.message),I(a)}).catch(i=>u.error(`Error http delete customer file by id: ${i.message}`))})},D=(t,i,l)=>{var q;_({pagination:t,filters:i,sortOrder:Array.isArray(l)?void 0:l.order,sortField:Array.isArray(l)?void 0:l.field}),t.pageSize!==((q=d.pagination)==null?void 0:q.pageSize)&&w([])};return n.useEffect(()=>{k()},[JSON.stringify(d),S]),e.jsxs("div",{className:"h-100 flex flex-column p-3",children:[e.jsxs("div",{className:"flex flex-md-column gap-3 justify-between",children:[e.jsx("h3",{children:g}),e.jsx("div",{children:e.jsx(U,{onSearch:t=>T(t),onReset:()=>T("")})}),e.jsx(h,{type:"primary",htmlType:"button",onClick:()=>{C(O),f("customer")},children:"Agregar"})]}),p?e.jsx(se,{dataSource:N,renderItem:t=>{var i;return e.jsxs("div",{className:"item-list",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Nombre: "})," ",t.cliente]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Nombre: "})," ",(i=t.tipo_cliente)==null?void 0:i.tipo_cliente]}),e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Telefono: "})," ",t.telefono_celular]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Correo: "})," ",t.correo]})]}),e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Estado: "})," ",t.estado?"Activo":"Inactivo"]}),e.jsx(h,{type:"link",danger:!0,htmlType:"button",icon:e.jsx(j.Edit,{}),onClick:()=>I(t),children:"Editar"})]})]},t.id_cliente)}}):e.jsx(X,{size:"small",rowClassName:(t,i)=>i%2===0?"table-row-light":"table-row-dark",pagination:{position:["none","bottomRight"],...d.pagination,showSizeChanger:!0,pageSizeOptions:[50,100,250,500]},onChange:D,className:"table",loading:y,showSorterTooltip:!1,rowKey:"id_cliente",dataSource:N,columns:[{title:"No",dataIndex:"id_cliente",sorter:!0},{title:"Nombre",dataIndex:"cliente",ellipsis:!0,sorter:!0},{title:"Tipo de Cliente",dataIndex:"tipo_cliente",ellipsis:!0,sorter:!0,render:t=>e.jsx("span",{children:t==null?void 0:t.tipo_cliente})},{title:"Telefono",dataIndex:"telefono_celular",sorter:!0},{title:"Correo",dataIndex:"correo",sorter:!0},{title:"Estado",dataIndex:"estado",render:t=>e.jsx("span",{className:t?"text-success":"text-danger",children:t?"Actuvi":"Inactivo"})},{title:"Opciones",dataIndex:"operacion",width:80,render:(t,i)=>e.jsx("div",{className:"text-center",children:e.jsx(h,{style:{width:40},icon:e.jsx(j.Edit,{}),type:"primary",size:"small",onClick:()=>I(i)})})}]}),e.jsx(E,{open:s.customer,footer:null,title:e.jsxs("div",{className:"flex flex-row gap-1",children:[(a==null?void 0:a.archivos)&&((A=a.archivos)==null?void 0:A.length)>0&&e.jsx(re,{placement:"bottomLeft",content:e.jsx(e.Fragment,{children:(F=a.archivos)==null?void 0:F.map(t=>e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx(h,{type:"link",size:"small",icon:e.jsx(j.Attachment,{}),onClick:()=>{c(t),f("preview")},children:t.nombre}),e.jsx(h,{size:"small",type:"text",htmlType:"button",danger:!0,ghost:!0,icon:e.jsx(j.Trash,{}),onClick:()=>z(t.id_archivo)})]},t.id_archivo))}),children:e.jsx(h,{type:"link",htmlType:"button",ghost:!0,icon:e.jsx(j.Attachment,{}),children:"Archivos"})}),e.jsxs("h3",{className:"text-primary",children:[a.id_cliente>0?"Editar":"Nuevo"," ",g.substring(0,g.length-1)]})]}),onCancel:()=>f("customer",!1),centered:!0,destroyOnClose:!0,children:e.jsx(le,{customer:a,onClose:()=>{f("customer",!1),k()}})}),e.jsx(E,{open:s.preview,footer:null,onCancel:()=>f("preview",!1),centered:!0,destroyOnClose:!0,children:e.jsx(M,{file:v})})]})};export{Te as Customer};
