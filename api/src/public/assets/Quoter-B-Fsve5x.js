import{m as ee,b as k,r as u,C as te,c as re,j as e,S as X,O as Z}from"./index-CGs_ZjVa.js";import{g as oe,m as ae,N as L,B as T,I as q,s as O}from"./method-http.utility-lkVWYHRi.js";import{M as V,h as se}from"./crane.service-D1AczQ14.js";import{h as ne}from"./aution.service-C6wZZJjZ.js";import{c as $,h as ie,g as le}from"./port.service-qwfx21y_.js";import{h as de}from"./customer.service-NHd4Dtgr.js";import{h as ce}from"./type-vehicle.service-Bf-e89OY.js";import{M as K,S as M,L as ue,F as me}from"./Table-B6Xee3V1.js";import{F as v,I as R}from"./index-BiKrhPYi.js";import{T as he}from"./index-BgKZLIBx.js";import"./Private-D3zam9Kl.js";const J={id_cotizacion:0,id_cliente:0,id_vendedor:0,id_tipo_vehiculo:0,marca:"",modelo:"",anio:"",id_puerto:0,estado:!0};var w=(t=>(t.USD="Grua EE.UU",t.GT="Grua GT",t.PORT_SHIPPING="Embarque",t.PORT_DOCUMENT_OR_EXP="ADUANA Y DOCS. EXP",t))(w||{});const W={nombre:"",moneda:"",valor:0},pe=t=>{const{componentCls:n,sizePaddingEdgeHorizontal:p,colorSplit:l,lineWidth:c,textPaddingInline:j,orientationMargin:x,verticalMarginInline:d}=t;return{[n]:Object.assign(Object.assign({},ee(t)),{borderBlockStart:`${k(c)} solid ${l}`,"&-vertical":{position:"relative",top:"-0.06em",display:"inline-block",height:"0.9em",marginInline:d,marginBlock:0,verticalAlign:"middle",borderTop:0,borderInlineStart:`${k(c)} solid ${l}`},"&-horizontal":{display:"flex",clear:"both",width:"100%",minWidth:"100%",margin:`${k(t.dividerHorizontalGutterMargin)} 0`},[`&-horizontal${n}-with-text`]:{display:"flex",alignItems:"center",margin:`${k(t.dividerHorizontalWithTextGutterMargin)} 0`,color:t.colorTextHeading,fontWeight:500,fontSize:t.fontSizeLG,whiteSpace:"nowrap",textAlign:"center",borderBlockStart:`0 ${l}`,"&::before, &::after":{position:"relative",width:"50%",borderBlockStart:`${k(c)} solid transparent`,borderBlockStartColor:"inherit",borderBlockEnd:0,transform:"translateY(50%)",content:"''"}},[`&-horizontal${n}-with-text-left`]:{"&::before":{width:`calc(${x} * 100%)`},"&::after":{width:`calc(100% - ${x} * 100%)`}},[`&-horizontal${n}-with-text-right`]:{"&::before":{width:`calc(100% - ${x} * 100%)`},"&::after":{width:`calc(${x} * 100%)`}},[`${n}-inner-text`]:{display:"inline-block",paddingBlock:0,paddingInline:j},"&-dashed":{background:"none",borderColor:l,borderStyle:"dashed",borderWidth:`${k(c)} 0 0`},[`&-horizontal${n}-with-text${n}-dashed`]:{"&::before, &::after":{borderStyle:"dashed none none"}},[`&-vertical${n}-dashed`]:{borderInlineStartWidth:c,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},"&-dotted":{background:"none",borderColor:l,borderStyle:"dotted",borderWidth:`${k(c)} 0 0`},[`&-horizontal${n}-with-text${n}-dotted`]:{"&::before, &::after":{borderStyle:"dotted none none"}},[`&-vertical${n}-dotted`]:{borderInlineStartWidth:c,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${n}-with-text`]:{color:t.colorText,fontWeight:"normal",fontSize:t.fontSize},[`&-horizontal${n}-with-text-left${n}-no-default-orientation-margin-left`]:{"&::before":{width:0},"&::after":{width:"100%"},[`${n}-inner-text`]:{paddingInlineStart:p}},[`&-horizontal${n}-with-text-right${n}-no-default-orientation-margin-right`]:{"&::before":{width:"100%"},"&::after":{width:0},[`${n}-inner-text`]:{paddingInlineEnd:p}}})}},xe=t=>({textPaddingInline:"1em",orientationMargin:.05,verticalMarginInline:t.marginXS}),fe=oe("Divider",t=>{const n=ae(t,{dividerHorizontalWithTextGutterMargin:t.margin,dividerHorizontalGutterMargin:t.marginLG,sizePaddingEdgeHorizontal:0});return[pe(n)]},xe,{unitless:{orientationMargin:!0}});var ge=function(t,n){var p={};for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&n.indexOf(l)<0&&(p[l]=t[l]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,l=Object.getOwnPropertySymbols(t);c<l.length;c++)n.indexOf(l[c])<0&&Object.prototype.propertyIsEnumerable.call(t,l[c])&&(p[l[c]]=t[l[c]]);return p};const U=t=>{const{getPrefixCls:n,direction:p,divider:l}=u.useContext(te),{prefixCls:c,type:j="horizontal",orientation:x="center",orientationMargin:d,className:S,rootClassName:E,children:y,dashed:G,variant:a="solid",plain:g,style:b}=t,P=ge(t,["prefixCls","type","orientation","orientationMargin","className","rootClassName","children","dashed","variant","plain","style"]),m=n("divider",c),[D,f,z]=fe(m),A=!!y,B=x==="left"&&d!=null,F=x==="right"&&d!=null,Q=re(m,l==null?void 0:l.className,f,z,`${m}-${j}`,{[`${m}-with-text`]:A,[`${m}-with-text-${x}`]:A,[`${m}-dashed`]:!!G,[`${m}-${a}`]:a!=="solid",[`${m}-plain`]:!!g,[`${m}-rtl`]:p==="rtl",[`${m}-no-default-orientation-margin-left`]:B,[`${m}-no-default-orientation-margin-right`]:F},S,E),r=u.useMemo(()=>typeof d=="number"?d:/^\d+$/.test(d)?Number(d):d,[d]),o=Object.assign(Object.assign({},B&&{marginLeft:r}),F&&{marginRight:r});return D(u.createElement("div",Object.assign({className:Q,style:Object.assign(Object.assign({},l==null?void 0:l.style),b)},P,{role:"separator"}),y&&j!=="vertical"&&u.createElement("span",{className:`${m}-inner-text`,style:o},y)))},Y="/quoter",be=async()=>await L({path:Y,method:"GET"}),je=async t=>await L({path:Y,method:"POST",data:t}),_e=async t=>await L({path:`${Y}/${t.id_cotizacion}`,method:"PUT",data:t}),ve=({costs:t,onSubmit:n})=>{const[p,l]=u.useState(W),[c,j]=u.useState(!1),x=async d=>{const S=[...t];S[p.index??0]={...d,valor:$(d.valor??"")},n(S),j(!1)};return e.jsxs(e.Fragment,{children:[t.map((d,S)=>e.jsxs("div",{className:"flex flex-row justify-between gap-3 items-center",children:[e.jsxs("strong",{className:"flex-1",children:[d.nombre,": "]}),e.jsx("span",{children:d.moneda}),e.jsx("span",{children:d.valor}),e.jsxs("div",{children:[e.jsx(T,{type:"link",htmlType:"button",size:"small",icon:e.jsx(q.Edit,{}),onClick:()=>{l({...d,index:S}),j(!0)}}),e.jsx(T,{danger:!0,type:"link",size:"small",htmlType:"button",icon:e.jsx(q.Trash,{}),onClick:()=>n(t.filter((E,y)=>y!==S))})]})]},S)),e.jsx("div",{className:"text-right mt-3",children:e.jsx(T,{type:"primary",style:{color:X.secondary,borderColor:X.secondary},ghost:!0,size:"small",htmlType:"button",icon:e.jsx(q.Plus,{}),onClick:()=>{const d=[...t];d.push(W),n(d),l({...W,index:d.length-1}),j(!0)},children:"Agregar"})}),e.jsx(K,{open:c,onCancel:()=>j(!1),footer:null,title:"Editar",destroyOnClose:!0,children:e.jsxs(v,{layout:"vertical",initialValues:p,onFinish:x,children:[e.jsx(v.Item,{label:"Titulo",name:"nombre",rules:[{required:!0,message:"El campo es requerido"}],children:e.jsx(R,{placeholder:"Ingrese un titulo"})}),e.jsx(v.Item,{label:"Moneda",name:"moneda",rules:[{required:!0,message:"El campo es requerido"}],children:e.jsx(M,{allowClear:!0,className:"w-100",placeholder:"Selecciones una opción",options:Object.keys(V).map(d=>({label:d,value:d}))})}),e.jsx(v.Item,{label:"Valor",name:"valor",rules:[{required:!0,message:"El campo es requerido"}],children:e.jsx(he,{placeholder:"Ingrese un valor",className:"w-100",formatter:d=>$(d??"")})}),e.jsx("div",{className:"text-right mt-3",children:e.jsx(T,{type:"primary",htmlType:"submit",children:"Guardar"})})]})})]})},Se=({quoter:t,onClose:n})=>{var Q;const p=u.useRef(null),l=Z(r=>r.session),[c,j]=u.useState([]),[x,d]=u.useState([]),[S,E]=u.useState([]),[y,G]=u.useState([]),[a,g]=u.useState([]),[b,P]=u.useState({USD:[],GTQ:[],all:[]}),[m,D]=u.useState(!1),[f,z]=u.useState([]),A=r=>{var N;const[o,s]=Object.entries(r)[0];if(o==="id_subasta"){const C=b.all.filter(i=>{var h;return((h=i.subasta)==null?void 0:h.id_subasta)===s&&i.estado});C&&P({...b,USD:C}),(N=p.current)==null||N.setFieldValue("id_grua_usd",void 0)}B()},B=()=>{var o;const r=(o=p.current)==null?void 0:o.getFieldsValue();if(r&&r.id_cliente){let s=[...f];const N=c.find(i=>i.id_cliente===r.id_cliente),C=x.find(i=>i.id_puerto===r.id_puerto);if(C){const i=f.findIndex(_=>_.nombre===w.PORT_DOCUMENT_OR_EXP);if(i>-1){const _=f[i];_.valor=$(C.costo_aduanal)}else s.push({nombre:w.PORT_DOCUMENT_OR_EXP,moneda:V.USD,valor:$(C.costo_aduanal)});const h=S.find(_=>_.id_tipo_vehiculo===r.id_tipo_vehiculo);if(h){const _=f.findIndex(H=>H.nombre===w.PORT_SHIPPING),I=Number(C.costo_embarque)+Number(C.costo_embarque)*(Number(h.porcentaje_costo)/100);if(_>-1){const H=f[_];H.valor=$(I)}else s.push({nombre:w.PORT_SHIPPING,moneda:V.USD,valor:$(I)})}}if(N){if(r.id_grua_usd){const i=b.USD.find(h=>h.id_grua===r.id_grua_usd);if(i&&i.costo>0){const h=Number(i.costo)+Number(i.costo)*(Number(N.porcentaje_costo)/100),_=f.findIndex(I=>I.nombre===w.USD);if(_>-1){const I=f[_];I.valor=$(h)}else s.push({nombre:w.USD,moneda:i.moneda,valor:$(h)})}}else s=s.filter(i=>i.nombre!==w.USD);if(r.id_grua_gt){const i=b.GTQ.find(h=>h.id_grua===r.id_grua_gt);if(i&&i.costo>0){const h=Number(i.costo)+Number(i.costo)*(Number(N.porcentaje_costo)/100),_=f.findIndex(I=>I.nombre===w.GT);if(_>-1){const I=f[_];I.valor=$(h)}else s.push({nombre:w.GT,moneda:i.moneda,valor:$(h)})}}else s=s.filter(i=>i.nombre!==w.GT)}z(s)}},F=async r=>{try{D(!0);let o;const s={...t,...r,costos:f};t.id_cotizacion===0?o=await je({...s,id_vendedor:l.id_sesion}):o=await _e(s),o.message?O.warning(o.message):n()}catch(o){O.error(`Error add or edit ouoter: ${o.message}`)}finally{D(!1)}};return u.useEffect(()=>{const r=[];r.push({}),G(r),t.costos&&z(t.costos),de().then(o=>j(o==null?void 0:o.filter(s=>s.estado))).catch(o=>O.error(`Error http get customers: ${o.message}}`)),ie().then(o=>d(o==null?void 0:o.filter(s=>s.estado))).catch(o=>O.error(`Error http get ports: ${o.message}}`)),ce().then(o=>E(o==null?void 0:o.filter(s=>s.estado))).catch(o=>O.error(`Error http get type of vehicles: ${o.message}}`)),ne().then(o=>g(o==null?void 0:o.filter(s=>s.estado))).catch(o=>O.error(`Error http get autions: ${o.message}}`)),se().then(o=>{const s=o==null?void 0:o.filter(i=>i.estado),N=s==null?void 0:s.filter(i=>i.moneda===V.GTQ),C=s==null?void 0:s.filter(i=>{var h;return i.moneda===V.USD&&((h=i.subasta)==null?void 0:h.id_subasta)===t.id_subasta});P({...b,GTQ:N,all:s,USD:C})}).catch(o=>O.error(`Error http get cranes: ${o.message}}`))},[]),e.jsx(e.Fragment,{children:e.jsxs(v,{ref:p,initialValues:t.id_cotizacion===0?{}:t,layout:"vertical",onFinish:F,onValuesChange:A,children:[e.jsx("div",{className:"vhm-75 overflow-y",children:e.jsxs("div",{className:"flex flex-md-column justify-between",children:[e.jsxs("div",{className:"flex-1 p-3",children:[e.jsx(U,{orientation:"left",children:"Información del Cliente/Puerto"}),e.jsx(v.Item,{label:"Cliente",name:"id_cliente",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(M,{className:"w-100",placeholder:"Selecciones una opción",options:c.map(r=>({label:r.cliente,value:r.id_cliente}))})}),e.jsx(v.Item,{label:"Puerto",name:"id_puerto",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(M,{className:"w-100",placeholder:"Selecciones una opción",options:x.map(r=>({label:r.puerto,value:r.id_puerto}))})}),e.jsx(U,{orientation:"left",children:"Información del vehículo"}),y.map((r,o)=>e.jsxs("div",{children:[r.id&&e.jsx(e.Fragment,{children:e.jsx(U,{children:e.jsx(T,{icon:e.jsx(q.ArrowDown,{}),size:"small",type:"link",htmlType:"button",danger:!0,onClick:()=>{const s=[...y].filter(N=>N.id!==r.id);G(s)},children:"Eliminar"})})}),e.jsxs("div",{className:"flex flex-md-column gap-3 justify-between item-end",children:[e.jsx(v.Item,{label:"Tipo de Vehículo",name:`${r.id?r.id+"-":""}id_tipo_vehiculo`,rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:e.jsx(M,{className:"w-100",placeholder:"Selecciones una opción",options:S.map(s=>({label:s.tipo_vehiculo,value:s.id_tipo_vehiculo}))})}),e.jsx(v.Item,{label:"Año",name:`${r.id?r.id+"-":""}anio`,rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:e.jsx(R,{placeholder:"Ingrese un año"})})]}),e.jsxs("div",{className:"flex flex-md-column gap-3 justify-between item-end",children:[e.jsx(v.Item,{label:"Marca",name:`${r.id?r.id+"-":""}marca`,rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:e.jsx(R,{placeholder:"Ingrese una Marca"})}),e.jsx(v.Item,{label:"Modelo",name:`${r.id?r.id+"-":""}modelo`,rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:e.jsx(R,{placeholder:"Ingrese un Modelo"})})]})]},o))]}),e.jsxs("div",{className:"flex-1 p-3",children:[e.jsx(U,{orientation:"left",children:"Tramites EE. UU"}),e.jsx(v.Item,{label:"Subasta (optional)",name:"id_subasta",children:e.jsx(M,{allowClear:!0,className:"w-100",placeholder:"Selecciones una opción",options:a.map(r=>({label:r.subasta,value:r.id_subasta}))})}),e.jsx(v.Item,{label:"Grua (optional)",name:"id_grua_usd",children:e.jsx(M,{allowClear:!0,className:"w-100",placeholder:"Selecciones una opción",options:(Q=b.USD)==null?void 0:Q.map(r=>({label:r.grua,value:r.id_grua}))})}),e.jsx(U,{orientation:"left",children:"Tramites GT"}),e.jsx(v.Item,{label:"Grua (optional)",name:"id_grua_gt",children:e.jsx(M,{allowClear:!0,className:"w-100",placeholder:"Selecciones una opción",options:b.GTQ.map(r=>({label:r.grua,value:r.id_grua}))})}),e.jsx(U,{orientation:"left",children:"Costos"}),e.jsx(ve,{costs:f,onSubmit:z})]})]})}),e.jsx("div",{className:"text-right mt-3",children:e.jsx(T,{type:"primary",htmlType:"submit",loading:m,disabled:m,children:"Guardar"})})]})})},Ge=()=>{const t=Z(a=>a.device),[n,p]=u.useState([]),[l,c]=u.useState(J),[j,x]=u.useState(!1),[d,S]=u.useState({form:!1,preview:!1}),E=(a,g=!0)=>S({[a]:g}),y=a=>{var g,b,P,m,D,f,z;c({...a,id_cliente:(g=a.cliente)==null?void 0:g.id_cliente,id_vendedor:(b=a.vendedor)==null?void 0:b.id_usuario,id_tipo_vehiculo:(P=a.tipo_veniculo)==null?void 0:P.id_tipo_vehiculo,id_puerto:(m=a.puerto)==null?void 0:m.id_puerto,id_subasta:(D=a.subasta)==null?void 0:D.id_subasta,id_grua_usd:(f=a.grua_usd)==null?void 0:f.id_grua,id_grua_gt:(z=a.grua_gt)==null?void 0:z.id_grua}),E("form")},G=()=>{x(!0),be().then(a=>p(a)).catch(a=>O.error(`Error http get quoters: ${a.message}`)).finally(()=>x(!1))};return u.useEffect(()=>{G()},[]),e.jsxs("div",{className:"h-100 flex flex-column p-3",children:[e.jsxs("div",{className:"flex flex-md-column gap-3 justify-between items-end",children:[e.jsxs("div",{className:"flex flex-column",children:[e.jsx("label",{htmlFor:"cliente",children:"Cliente"}),e.jsx(M,{placeholder:"Seleccione una opcion"})]}),e.jsx("div",{children:e.jsx(R.Search,{placeholder:"Buscar",onSearch:()=>{},enterButton:!0})}),e.jsx(T,{type:"primary",htmlType:"button",onClick:()=>{c(J),E("form")},children:"Agregar"})]}),t?e.jsx(ue,{dataSource:n,loading:j,renderItem:a=>{var g,b;return e.jsxs("div",{className:"item-list",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Cliente: "})," ",(g=a.cliente)==null?void 0:g.cliente]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Vendedor: "})," ",(b=a.vendedor)==null?void 0:b.nombre]}),e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Estado: "})," ",a.estado?"Activo":"Inactivo"]}),e.jsx(T,{type:"link",danger:!0,htmlType:"button",icon:e.jsx(q.Edit,{}),onClick:()=>y(a),children:"Editar"})]})]},a.id_cotizacion)}}):e.jsx(me,{size:"small",rowClassName:(a,g)=>g%2===0?"table-row-light":"table-row-dark",pagination:{position:["none","bottomRight"],showSizeChanger:!0,pageSizeOptions:[50,100,250,500]},className:"table",loading:j,showSorterTooltip:!1,rowKey:"id_cotizacion",dataSource:n,columns:[{title:"No",dataIndex:"id_cotizacion"},{title:"Fecha",dataIndex:"fecha_creacion",ellipsis:!0,sorter:!0,render:a=>e.jsx("span",{children:le(a,"DD/MM/YYYY")})},{title:"Vendedor",dataIndex:"vendedor",ellipsis:!0,sorter:!0,render:a=>e.jsx("span",{children:a.nombre})},{title:"Cliente",dataIndex:"cliente",ellipsis:!0,sorter:!0,render:a=>e.jsx("span",{children:a.cliente})},{title:"Marca",dataIndex:"marca",ellipsis:!0,sorter:!0},{title:"Modelo",dataIndex:"modelo",ellipsis:!0,sorter:!0},{title:"Estado",dataIndex:"estado",render:a=>e.jsx("span",{className:a?"text-success":"text-danger",children:a?"Activo":"Inactivo"})},{title:"Opciones",dataIndex:"operacion",width:80,render:(a,g)=>e.jsx("div",{className:"text-center",children:e.jsx(T,{style:{width:40},icon:e.jsx(q.Edit,{}),type:"primary",size:"small",onClick:()=>y(g)})})}]}),e.jsx(K,{open:d.form,title:e.jsxs("h3",{children:[l.id_cotizacion>0?"Editar":"Agregar"," Cotización"]}),footer:null,onCancel:()=>E("form",!1),centered:!0,destroyOnClose:!0,width:1200,children:e.jsx(Se,{quoter:l,onClose:()=>{G(),E("form",!1)}})})]})};export{Ge as Quoter};
