import{m as le,b as B,r as d,C as J,c as X,T as be,j as t,S as re,O as ae}from"./index-CDpb26wA.js";import{g as ie,m as ce,Q as de,w as xe,o as ve,x as je,S as ye,W as Ce,U as Se,N as H,B as E,I as P,s as k,T as F}from"./method-http.utility-DJp8EY4u.js";import{c as D,h as _e,g as we}from"./port.service-CD7efNBC.js";import{M as G}from"./Utilityes.d-EXBqBskY.js";import{h as $e}from"./aution.service-DW1cfQ9T.js";import{h as Ie}from"./crane.service-Y1rMlKyO.js";import{h as Ne}from"./customer.service-BTdyi69Q.js";import{h as Te}from"./type-vehicle.service-C8EooSI3.js";import{M as ue,S as U,L as Ee,F as Oe}from"./Table-DgGj-QlZ.js";import{F as N,I as R}from"./index-Cre2wbHe.js";import{T as ze}from"./index-Dst4M1D7.js";import{u as Pe,p as ne}from"./Private-BXn6z3dS.js";const se={id_cotizacion:0,id_cliente:0,id_vendedor:0,id_tipo_vehiculo:0,marca:"",modelo:"",anio:"",id_puerto:0,estado:!0};var M=(e=>(e.USD="Grua EE.UU",e.GTQ="Grua GT",e.PORT_SHIPPING="Embarque",e.PORT_DOCUMENT_OR_EXP="ADUANA Y DOCS. EXP",e))(M||{});const Me={nombre:"",moneda:"",valor:0},De=e=>{const{componentCls:a,sizePaddingEdgeHorizontal:i,colorSplit:r,lineWidth:s,textPaddingInline:g,orientationMargin:c,verticalMarginInline:f}=e;return{[a]:Object.assign(Object.assign({},le(e)),{borderBlockStart:`${B(s)} solid ${r}`,"&-vertical":{position:"relative",top:"-0.06em",display:"inline-block",height:"0.9em",marginInline:f,marginBlock:0,verticalAlign:"middle",borderTop:0,borderInlineStart:`${B(s)} solid ${r}`},"&-horizontal":{display:"flex",clear:"both",width:"100%",minWidth:"100%",margin:`${B(e.dividerHorizontalGutterMargin)} 0`},[`&-horizontal${a}-with-text`]:{display:"flex",alignItems:"center",margin:`${B(e.dividerHorizontalWithTextGutterMargin)} 0`,color:e.colorTextHeading,fontWeight:500,fontSize:e.fontSizeLG,whiteSpace:"nowrap",textAlign:"center",borderBlockStart:`0 ${r}`,"&::before, &::after":{position:"relative",width:"50%",borderBlockStart:`${B(s)} solid transparent`,borderBlockStartColor:"inherit",borderBlockEnd:0,transform:"translateY(50%)",content:"''"}},[`&-horizontal${a}-with-text-left`]:{"&::before":{width:`calc(${c} * 100%)`},"&::after":{width:`calc(100% - ${c} * 100%)`}},[`&-horizontal${a}-with-text-right`]:{"&::before":{width:`calc(100% - ${c} * 100%)`},"&::after":{width:`calc(${c} * 100%)`}},[`${a}-inner-text`]:{display:"inline-block",paddingBlock:0,paddingInline:g},"&-dashed":{background:"none",borderColor:r,borderStyle:"dashed",borderWidth:`${B(s)} 0 0`},[`&-horizontal${a}-with-text${a}-dashed`]:{"&::before, &::after":{borderStyle:"dashed none none"}},[`&-vertical${a}-dashed`]:{borderInlineStartWidth:s,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},"&-dotted":{background:"none",borderColor:r,borderStyle:"dotted",borderWidth:`${B(s)} 0 0`},[`&-horizontal${a}-with-text${a}-dotted`]:{"&::before, &::after":{borderStyle:"dotted none none"}},[`&-vertical${a}-dotted`]:{borderInlineStartWidth:s,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${a}-with-text`]:{color:e.colorText,fontWeight:"normal",fontSize:e.fontSize},[`&-horizontal${a}-with-text-left${a}-no-default-orientation-margin-left`]:{"&::before":{width:0},"&::after":{width:"100%"},[`${a}-inner-text`]:{paddingInlineStart:i}},[`&-horizontal${a}-with-text-right${a}-no-default-orientation-margin-right`]:{"&::before":{width:"100%"},"&::after":{width:0},[`${a}-inner-text`]:{paddingInlineEnd:i}}})}},Ge=e=>({textPaddingInline:"1em",orientationMargin:.05,verticalMarginInline:e.marginXS}),ke=ie("Divider",e=>{const a=ce(e,{dividerHorizontalWithTextGutterMargin:e.margin,dividerHorizontalGutterMargin:e.marginLG,sizePaddingEdgeHorizontal:0});return[De(a)]},Ge,{unitless:{orientationMargin:!0}});var Be=function(e,a){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&a.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)a.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};const q=e=>{const{getPrefixCls:a,direction:i,divider:r}=d.useContext(J),{prefixCls:s,type:g="horizontal",orientation:c="center",orientationMargin:f,className:u,rootClassName:j,children:x,dashed:S,variant:w="solid",plain:_,style:T}=e,p=Be(e,["prefixCls","type","orientation","orientationMargin","className","rootClassName","children","dashed","variant","plain","style"]),n=a("divider",s),[l,y,O]=ke(n),o=!!x,h=c==="left"&&f!=null,C=c==="right"&&f!=null,b=X(n,r==null?void 0:r.className,y,O,`${n}-${g}`,{[`${n}-with-text`]:o,[`${n}-with-text-${c}`]:o,[`${n}-dashed`]:!!S,[`${n}-${w}`]:w!=="solid",[`${n}-plain`]:!!_,[`${n}-rtl`]:i==="rtl",[`${n}-no-default-orientation-margin-left`]:h,[`${n}-no-default-orientation-margin-right`]:C},u,j),v=d.useMemo(()=>typeof f=="number"?f:/^\d+$/.test(f)?Number(f):f,[f]),m=Object.assign(Object.assign({},h&&{marginLeft:v}),C&&{marginRight:v});return l(d.createElement("div",Object.assign({className:b,style:Object.assign(Object.assign({},r==null?void 0:r.style),T)},p,{role:"separator"}),x&&g!=="vertical"&&d.createElement("span",{className:`${n}-inner-text`,style:m},x)))},Ue=e=>{const{paddingXXS:a,lineWidth:i,tagPaddingHorizontal:r,componentCls:s,calc:g}=e,c=g(r).sub(i).equal(),f=g(a).sub(i).equal();return{[s]:Object.assign(Object.assign({},le(e)),{display:"inline-block",height:"auto",marginInlineEnd:e.marginXS,paddingInline:c,fontSize:e.tagFontSize,lineHeight:e.tagLineHeight,whiteSpace:"nowrap",background:e.defaultBg,border:`${B(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:e.borderRadiusSM,opacity:1,transition:`all ${e.motionDurationMid}`,textAlign:"start",position:"relative",[`&${s}-rtl`]:{direction:"rtl"},"&, a, a:hover":{color:e.defaultColor},[`${s}-close-icon`]:{marginInlineStart:f,fontSize:e.tagIconSize,color:e.colorTextDescription,cursor:"pointer",transition:`all ${e.motionDurationMid}`,"&:hover":{color:e.colorTextHeading}},[`&${s}-has-color`]:{borderColor:"transparent",[`&, a, a:hover, ${e.iconCls}-close, ${e.iconCls}-close:hover`]:{color:e.colorTextLightSolid}},"&-checkable":{backgroundColor:"transparent",borderColor:"transparent",cursor:"pointer",[`&:not(${s}-checkable-checked):hover`]:{color:e.colorPrimary,backgroundColor:e.colorFillSecondary},"&:active, &-checked":{color:e.colorTextLightSolid},"&-checked":{backgroundColor:e.colorPrimary,"&:hover":{backgroundColor:e.colorPrimaryHover}},"&:active":{backgroundColor:e.colorPrimaryActive}},"&-hidden":{display:"none"},[`> ${e.iconCls} + span, > span + ${e.iconCls}`]:{marginInlineStart:c}}),[`${s}-borderless`]:{borderColor:"transparent",background:e.tagBorderlessBg}}},Z=e=>{const{lineWidth:a,fontSizeIcon:i,calc:r}=e,s=e.fontSizeSM;return ce(e,{tagFontSize:s,tagLineHeight:B(r(e.lineHeightSM).mul(s).equal()),tagIconSize:r(i).sub(r(a).mul(2)).equal(),tagPaddingHorizontal:8,tagBorderlessBg:e.defaultBg})},K=e=>({defaultBg:new be(e.colorFillQuaternary).onBackground(e.colorBgContainer).toHexString(),defaultColor:e.colorText}),me=ie("Tag",e=>{const a=Z(e);return Ue(a)},K);var Ve=function(e,a){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&a.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)a.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};const Re=d.forwardRef((e,a)=>{const{prefixCls:i,style:r,className:s,checked:g,onChange:c,onClick:f}=e,u=Ve(e,["prefixCls","style","className","checked","onChange","onClick"]),{getPrefixCls:j,tag:x}=d.useContext(J),S=l=>{c==null||c(!g),f==null||f(l)},w=j("tag",i),[_,T,p]=me(w),n=X(w,`${w}-checkable`,{[`${w}-checkable-checked`]:g},x==null?void 0:x.className,s,T,p);return _(d.createElement("span",Object.assign({},u,{ref:a,style:Object.assign(Object.assign({},r),x==null?void 0:x.style),className:n,onClick:S})))}),Qe=e=>xe(e,(a,i)=>{let{textColor:r,lightBorderColor:s,lightColor:g,darkColor:c}=i;return{[`${e.componentCls}${e.componentCls}-${a}`]:{color:r,background:g,borderColor:s,"&-inverse":{color:e.colorTextLightSolid,background:c,borderColor:c},[`&${e.componentCls}-borderless`]:{borderColor:"transparent"}}}}),qe=de(["Tag","preset"],e=>{const a=Z(e);return Qe(a)},K);function Ae(e){return typeof e!="string"?e:e.charAt(0).toUpperCase()+e.slice(1)}const L=(e,a,i)=>{const r=Ae(i);return{[`${e.componentCls}${e.componentCls}-${a}`]:{color:e[`color${i}`],background:e[`color${r}Bg`],borderColor:e[`color${r}Border`],[`&${e.componentCls}-borderless`]:{borderColor:"transparent"}}}},Fe=de(["Tag","status"],e=>{const a=Z(e);return[L(a,"success","Success"),L(a,"processing","Info"),L(a,"error","Error"),L(a,"warning","Warning")]},K);var He=function(e,a){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&a.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)a.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};const We=d.forwardRef((e,a)=>{const{prefixCls:i,className:r,rootClassName:s,style:g,children:c,icon:f,color:u,onClose:j,bordered:x=!0,visible:S}=e,w=He(e,["prefixCls","className","rootClassName","style","children","icon","color","onClose","bordered","visible"]),{getPrefixCls:_,direction:T,tag:p}=d.useContext(J),[n,l]=d.useState(!0),y=ve(w,["closeIcon","closable"]);d.useEffect(()=>{S!==void 0&&l(S)},[S]);const O=je(u),o=ye(u),h=O||o,C=Object.assign(Object.assign({backgroundColor:u&&!h?u:void 0},p==null?void 0:p.style),g),b=_("tag",i),[v,m,$]=me(b),I=X(b,p==null?void 0:p.className,{[`${b}-${u}`]:h,[`${b}-has-color`]:u&&!h,[`${b}-hidden`]:!n,[`${b}-rtl`]:T==="rtl",[`${b}-borderless`]:!x},r,s,m,$),z=Q=>{Q.stopPropagation(),j==null||j(Q),!Q.defaultPrevented&&l(!1)},[,A]=Pe(ne(e),ne(p),{closable:!1,closeIconRender:Q=>{const fe=d.createElement("span",{className:`${b}-close-icon`,onClick:z},Q);return Se(Q,fe,V=>({onClick:oe=>{var Y;(Y=V==null?void 0:V.onClick)===null||Y===void 0||Y.call(V,oe),z(oe)},className:X(V==null?void 0:V.className,`${b}-close-icon`)}))}}),pe=typeof w.onClick=="function"||c&&c.type==="a",ee=f||null,ge=ee?d.createElement(d.Fragment,null,ee,c&&d.createElement("span",null,c)):c,te=d.createElement("span",Object.assign({},y,{ref:a,className:I,style:C}),ge,A,O&&d.createElement(qe,{key:"preset",prefixCls:b}),o&&d.createElement(Fe,{key:"status",prefixCls:b}));return v(pe?d.createElement(Ce,{component:"Tag"},te):te)}),he=We;he.CheckableTag=Re;const Le=(e,a)=>{const i=window.URL.createObjectURL(new Blob([e])),r=document.createElement("a");r.href=i,r.setAttribute("download",a),document.body.appendChild(r),r.click()},W="/quoter",Xe=async()=>await H({path:W,method:"GET"}),Ye=async e=>await H({path:`${W}/${e}`,method:"GET"}),Je=async e=>await H({path:W,method:"POST",data:e}),Ze=async e=>await H({path:`${W}/${e.id_cotizacion}`,method:"PUT",data:e}),Ke=async e=>await H({path:`${W}/invoice/${e}`,method:"GET",responseType:"blob"}),et=({details:e,onSubmit:a})=>{const[i,r]=d.useState(Me),[s,g]=d.useState(!1),c=async u=>{const j=[...e];j.push({...u,valor:D(u.valor??"")}),a(j),g(!1)},f=u=>t.jsx(t.Fragment,{children:u.map((j,x)=>t.jsxs("div",{className:"flex flex-row justify-between gap-3 items-center",children:[t.jsxs("strong",{className:"flex-1",children:[j.nombre,": "]}),t.jsx("span",{children:j.moneda}),t.jsx("span",{children:D(j.valor??0)}),t.jsxs("div",{children:[t.jsx(E,{type:"link",htmlType:"button",size:"small",icon:t.jsx(P.Edit,{}),onClick:()=>{r({...j,index:x}),g(!0)}}),t.jsx(E,{danger:!0,type:"link",size:"small",htmlType:"button",icon:t.jsx(P.Trash,{}),onClick:()=>{const S=e.filter(_=>_.moneda!==j.moneda),w=u.filter((_,T)=>T!==x);a([...S,...w])}})]})]},x))});return t.jsxs(t.Fragment,{children:[e.some(u=>u.moneda===G.USD)&&t.jsx(q,{orientation:"left",children:"Costos USD"}),f(e.filter(u=>u.moneda===G.USD)),e.some(u=>u.moneda===G.GTQ)&&t.jsx(q,{orientation:"left",children:"Costos GTQ"}),f(e.filter(u=>u.moneda===G.GTQ)),t.jsx("div",{className:"text-right mt-3",children:t.jsx(E,{type:"primary",style:{color:re.secondary,borderColor:re.secondary},ghost:!0,size:"small",htmlType:"button",icon:t.jsx(P.Plus,{}),onClick:()=>g(!0),children:"Agregar"})}),t.jsx(ue,{open:s,onCancel:()=>g(!1),footer:null,title:"Editar",destroyOnClose:!0,children:t.jsxs(N,{layout:"vertical",initialValues:i,onFinish:c,children:[t.jsx(N.Item,{label:"Titulo",name:"nombre",rules:[{required:!0,message:"El campo es requerido"}],children:t.jsx(R,{placeholder:"Ingrese un titulo"})}),t.jsx(N.Item,{label:"Moneda",name:"moneda",rules:[{required:!0,message:"El campo es requerido"}],children:t.jsx(U,{allowClear:!0,className:"w-100",placeholder:"Selecciones una opción",options:Object.keys(G).map(u=>({label:u,value:G[u]}))})}),t.jsx(N.Item,{label:"Valor",name:"valor",rules:[{required:!0,message:"El campo es requerido"}],children:t.jsx(ze,{placeholder:"Ingrese un valor",className:"w-100",formatter:u=>D(u??"")})}),t.jsx("div",{className:"text-right mt-3",children:t.jsx(E,{type:"primary",htmlType:"submit",children:"Guardar"})})]})})]})},tt=({quoter:e,loading:a,onSubmit:i,onDownloadInvoice:r})=>{var O;const s=d.useRef(null),[g,c]=d.useState([]),[f,u]=d.useState([]),[j,x]=d.useState([]),[S,w]=d.useState([]),[_,T]=d.useState({USD:[],GTQ:[],all:[]}),[p,n]=d.useState([]),l=o=>{var b;const[h,C]=Object.entries(o)[0];if(h==="id_subasta"){const v=_.all.filter(m=>{var $;return(($=m.subasta)==null?void 0:$.id_subasta)===C&&m.estado});v&&T({..._,USD:v}),(b=s.current)==null||b.setFieldValue("id_grua_usd",void 0)}y()},y=()=>{var h;const o=(h=s.current)==null?void 0:h.getFieldsValue();if(o&&o.id_cliente){let C=[...p];const b=g.find(m=>m.id_cliente===o.id_cliente),v=f.find(m=>m.id_puerto===o.id_puerto);if(v){const m=p.findIndex(I=>I.nombre===M.PORT_DOCUMENT_OR_EXP);if(m>-1){const I=p[m];I.valor=D(v.costo_aduanal)}else C.push({nombre:M.PORT_DOCUMENT_OR_EXP,moneda:G.USD,valor:D(v.costo_aduanal)});const $=j.find(I=>I.id_tipo_vehiculo===o.id_tipo_vehiculo);if($){const I=p.findIndex(A=>A.nombre===M.PORT_SHIPPING),z=Number(v.costo_embarque)+Number(v.costo_embarque)*(Number($.porcentaje_costo)/100);if(I>-1){const A=p[I];A.valor=D(z)}else C.push({nombre:M.PORT_SHIPPING,moneda:G.USD,valor:D(z)})}}if(b){if(o.id_grua_usd){const m=_.USD.find($=>$.id_grua===o.id_grua_usd);if(m&&m.costo>0){const $=Number(m.costo)+Number(m.costo)*(Number(b.porcentaje_costo)/100),I=p.findIndex(z=>z.nombre===M.USD);if(I>-1){const z=p[I];z.valor=D($)}else C.push({nombre:M.USD,moneda:m.moneda,valor:D($)})}}else C=C.filter(m=>m.nombre!==M.USD);if(o.id_grua_gt){const m=_.GTQ.find($=>$.id_grua===o.id_grua_gt);if(m&&m.costo>0){const $=Number(m.costo)+Number(m.costo)*(Number(b.porcentaje_costo)/100),I=p.findIndex(z=>z.nombre===M.GTQ);if(I>-1){const z=p[I];z.valor=D($)}else C.push({nombre:M.GTQ,moneda:m.moneda,valor:D($)})}}else C=C.filter(m=>m.nombre!==M.GTQ)}n(C)}};return d.useEffect(()=>{e.details&&n(e.details.map(o=>({...o,id:Math.random().toString()}))),Ne().then(o=>c(o==null?void 0:o.filter(h=>h.estado))).catch(o=>k.error(`Error http get customers: ${o.message}}`)),_e().then(o=>u(o==null?void 0:o.filter(h=>h.estado))).catch(o=>k.error(`Error http get ports: ${o.message}}`)),Te().then(o=>x(o==null?void 0:o.filter(h=>h.estado))).catch(o=>k.error(`Error http get type of vehicles: ${o.message}}`)),$e().then(o=>w(o==null?void 0:o.filter(h=>h.estado))).catch(o=>k.error(`Error http get autions: ${o.message}}`)),Ie().then(o=>{const h=o==null?void 0:o.filter(v=>v.estado),C=h==null?void 0:h.filter(v=>v.moneda===G.GTQ),b=h==null?void 0:h.filter(v=>{var m;return v.moneda===G.USD&&((m=v.subasta)==null?void 0:m.id_subasta)===e.id_subasta});T({..._,GTQ:C,all:h,USD:b})}).catch(o=>k.error(`Error http get cranes: ${o.message}}`))},[]),t.jsx(t.Fragment,{children:t.jsxs(N,{ref:s,initialValues:e.id_cotizacion===0?{}:e,layout:"vertical",onFinish:o=>i(o,p),onValuesChange:l,children:[t.jsx("div",{className:"vhm-75 overflow-y",children:t.jsxs("div",{className:"flex flex-md-column justify-between",children:[t.jsxs("div",{className:"flex-1 p-3",children:[t.jsx(q,{orientation:"left",children:"Información del Cliente/Puerto"}),t.jsx(N.Item,{label:"Cliente",name:"id_cliente",rules:[{required:!0,message:"El campo es obligatorio"}],children:t.jsx(U,{className:"w-100",placeholder:"Selecciones una opción",options:g.map(o=>({label:o.cliente,value:o.id_cliente}))})}),t.jsx(N.Item,{label:"Puerto",name:"id_puerto",rules:[{required:!0,message:"El campo es obligatorio"}],children:t.jsx(U,{className:"w-100",placeholder:"Selecciones una opción",options:f.map(o=>({label:o.puerto,value:o.id_puerto}))})}),t.jsx(q,{orientation:"left",children:"Información del vehículo"}),t.jsxs("div",{className:"flex flex-md-column gap-3 justify-between item-end",children:[t.jsx(N.Item,{label:"Tipo de Vehículo",name:"id_tipo_vehiculo",rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:t.jsx(U,{className:"w-100",placeholder:"Selecciones una opción",options:j.map(o=>({label:o.tipo_vehiculo,value:o.id_tipo_vehiculo}))})}),t.jsx(N.Item,{label:"Año",name:"anio",rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:t.jsx(R,{placeholder:"Ingrese un año"})})]}),t.jsxs("div",{className:"flex flex-md-column gap-3 justify-between item-end",children:[t.jsx(N.Item,{label:"Marca",name:"marca",rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:t.jsx(R,{placeholder:"Ingrese una Marca"})}),t.jsx(N.Item,{label:"Modelo",name:"modelo",rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:t.jsx(R,{placeholder:"Ingrese un Modelo"})})]}),t.jsxs("div",{className:"flex flex-md-column gap-3 justify-between item-end",children:[t.jsx(N.Item,{label:"Serie",name:"serie",rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:t.jsx(R,{placeholder:"Ingrese una Serie"})}),t.jsx(N.Item,{label:"VIN",name:"vin",rules:[{required:!0,message:"El campo es requerido"}],className:"w-100",children:t.jsx(R,{placeholder:"Ingrese un VIN"})})]})]}),t.jsxs("div",{className:"flex-1 p-3",children:[t.jsx(q,{orientation:"left",children:"Tramites EE. UU"}),t.jsx(N.Item,{label:"Subasta (optional)",name:"id_subasta",children:t.jsx(U,{allowClear:!0,className:"w-100",placeholder:"Selecciones una opción",options:S.map(o=>({label:o.subasta,value:o.id_subasta}))})}),t.jsx(N.Item,{label:"Grua (optional)",name:"id_grua_usd",children:t.jsx(U,{allowClear:!0,className:"w-100",placeholder:"Selecciones una opción",options:(O=_.USD)==null?void 0:O.map(o=>({label:o.grua,value:o.id_grua}))})}),t.jsx(q,{orientation:"left",children:"Tramites GT"}),t.jsx(N.Item,{label:"Grua (optional)",name:"id_grua_gt",children:t.jsx(U,{allowClear:!0,className:"w-100",placeholder:"Selecciones una opción",options:_.GTQ.map(o=>({label:o.grua,value:o.id_grua}))})}),t.jsx(et,{details:p,onSubmit:o=>n(o)})]})]})}),t.jsxs("div",{className:"flex flex-row justify-end gap-2",children:[t.jsx(E,{type:"link",htmlType:"button",loading:a,disabled:a||e.id_cotizacion===0,icon:t.jsx(P.Download,{}),onClick:()=>r(e),children:"Descargar"}),t.jsx(E,{type:"dashed",htmlType:"button",loading:a,disabled:a||e.id_cotizacion===0,icon:t.jsx(P.EMail,{}),children:"Enviar Correo"}),!e.aprobada&&t.jsx(E,{type:"primary",ghost:!0,htmlType:"button",loading:a,disabled:a||e.id_cotizacion===0,icon:t.jsx(P.Done,{}),onClick:()=>r(e),children:"Aprobar"}),t.jsx(E,{type:"primary",htmlType:"submit",icon:t.jsx(P.Save,{}),loading:a,disabled:a||e.aprobada,children:"Guardar"})]})]})})},pt=()=>{const e=ae(n=>n.device),a=ae(n=>n.session),[i,r]=d.useState([]),[s,g]=d.useState(se),[c,f]=d.useState({data:!1,services:!1}),[u,j]=d.useState({form:!1,preview:!1}),x=(n,l=!0)=>j({[n]:l}),S=(n,l)=>f({...c,[n]:l}),w=n=>{Ye(n).then(l=>{var y,O,o,h,C,b,v;g({...l,id_cliente:(y=l.cliente)==null?void 0:y.id_cliente,id_vendedor:(O=l.vendedor)==null?void 0:O.id_usuario,id_tipo_vehiculo:(o=l.tipo_veniculo)==null?void 0:o.id_tipo_vehiculo,id_puerto:(h=l.puerto)==null?void 0:h.id_puerto,id_subasta:(C=l.subasta)==null?void 0:C.id_subasta,id_grua_usd:(b=l.grua_usd)==null?void 0:b.id_grua,id_grua_gt:(v=l.grua_gt)==null?void 0:v.id_grua}),x("form")}).catch(l=>k.error(`Error http get quoters: ${l.message}`))},_=async(n,l)=>{try{S("services",!0);let y;const O={...s,...n,detalles:l};s.id_cotizacion===0?y=await Je({...O,id_vendedor:a.id_sesion}):y=await Ze(O),y.message?k.warning(y.message):(p(),x("form",!1))}catch(y){k.error(`Error add or edit ouoter: ${y.message}`)}finally{S("services",!1)}},T=async n=>{S("services",!0),Ke(n.id_cotizacion).then(l=>{var y;return Le(l,`${((y=n.cliente)==null?void 0:y.cliente)??"cotizacion"}-invoice.zip`)}).catch(l=>k.error(`Error http download invoice: ${l.message}`)).finally(()=>S("services",!1))},p=()=>{S("data",!0),Xe().then(n=>r(n)).catch(n=>k.error(`Error http get quoters: ${n.message}`)).finally(()=>S("data",!1))};return d.useEffect(()=>{p()},[]),t.jsxs("div",{className:"h-100 flex flex-column p-3",children:[t.jsxs("div",{className:"flex flex-md-column gap-3 justify-between items-end",children:[t.jsxs("div",{className:"flex flex-column",children:[t.jsx("label",{htmlFor:"cliente",children:"Cliente"}),t.jsx(U,{placeholder:"Seleccione una opcion"})]}),t.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[t.jsx(F,{title:"Recargar",children:t.jsx(E,{type:"text",htmlType:"button",icon:t.jsx(P.Reload,{}),onClick:()=>p()})}),t.jsx(R.Search,{placeholder:"Buscar",onSearch:()=>{},enterButton:!0})]}),t.jsx(E,{type:"primary",htmlType:"button",onClick:()=>{g(se),x("form")},children:"Agregar"})]}),e?t.jsx(Ee,{dataSource:i,loading:c.data,renderItem:n=>{var l,y;return t.jsxs("div",{className:"item-list",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("strong",{children:"Cliente: "})," ",(l=n.cliente)==null?void 0:l.cliente]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("strong",{children:"Vendedor: "})," ",(y=n.vendedor)==null?void 0:y.nombre]}),t.jsxs("div",{className:"flex flex-row justify-between",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Estado: "})," ",n.estado?"Activo":"Inactivo"]}),t.jsx(E,{type:"link",danger:!0,htmlType:"button",icon:t.jsx(P.Edit,{}),onClick:()=>w(n.id_cotizacion),children:"Editar"})]})]},n.id_cotizacion)}}):t.jsx(Oe,{size:"small",rowClassName:(n,l)=>l%2===0?"table-row-light":"table-row-dark",pagination:{position:["none","bottomRight"],showSizeChanger:!0,pageSizeOptions:[50,100,250,500]},className:"table",loading:c.data,showSorterTooltip:!1,rowKey:"id_cotizacion",dataSource:i,columns:[{title:"No",dataIndex:"id_cotizacion"},{title:"Fecha",dataIndex:"fecha_creacion",ellipsis:!0,sorter:!0,render:n=>t.jsx("span",{children:we(n,"DD/MM/YYYY")})},{title:"Vendedor",dataIndex:"vendedor",ellipsis:!0,sorter:!0,render:n=>t.jsx("span",{children:n.nombre})},{title:"Cliente",dataIndex:"cliente",ellipsis:!0,sorter:!0,render:n=>t.jsx("span",{children:n.cliente})},{title:"Marca",dataIndex:"marca",ellipsis:!0,sorter:!0},{title:"Modelo",dataIndex:"modelo",ellipsis:!0,sorter:!0},{title:"Aprobada",dataIndex:"aprobada",align:"center",render:n=>t.jsx("span",{className:n?"text-success":"text-danger",children:t.jsx(he,{color:n?"success":"error",children:n?"Sí":"No"})})},{title:"Estado",dataIndex:"estado",render:n=>t.jsx("span",{className:n?"text-success":"text-danger",children:n?"Activo":"Inactivo"})},{title:"Opciones",dataIndex:"operacion",width:80,render:(n,l)=>t.jsxs("div",{className:"flex flex-row gap-1",children:[t.jsx(F,{title:"Editar",children:t.jsx(E,{style:{width:40},icon:t.jsx(P.Edit,{}),type:"text",size:"small",onClick:()=>w(l.id_cotizacion)})}),t.jsx(F,{title:"Descargar",children:t.jsx(E,{style:{width:40},icon:t.jsx(P.Download,{}),type:"text",size:"small",onClick:()=>T(l),disabled:c.services})}),!l.aprobada&&t.jsx(F,{title:"Aprobar",children:t.jsx(E,{style:{width:40},icon:t.jsx(P.Done,{}),type:"text",size:"small",onClick:()=>T(l),disabled:c.services})}),l.aprobada&&t.jsx(F,{title:"Ir a Vehiculos",children:t.jsx(E,{style:{width:40},icon:t.jsx(P.Workspace,{}),type:"text",size:"small",onClick:()=>T(l),disabled:c.services})})]})}]}),t.jsx(ue,{open:u.form,title:t.jsxs("h3",{children:[s.id_cotizacion>0?"Editar":"Agregar"," Cotización"]}),footer:null,onCancel:()=>x("form",!1),centered:!0,destroyOnClose:!0,width:1200,children:t.jsx(tt,{quoter:s,loading:c.services,onSubmit:_,onDownloadInvoice:T})})]})};export{pt as Quoter};
