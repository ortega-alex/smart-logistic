import{r,aV as W,q as H,j as e,aR as X,aU as q,p as Z,c as ee,a as te,b as $}from"./index-LOVzF4CI.js";import{s as h,I as v,B as g,T as B}from"./method-http.utility-DUkeS8Cu.js";import{a as ie}from"./customer.service-i0rFzX3W.js";import{h as se,a as le}from"./vehicles.service-B3zTUT4m.js";import{S as oe}from"./Search-DTngRLgV.js";import{E as L,V as ae}from"./ViewFiles-BL9Kboj_.js";import{M as k}from"./Utilityes.d-EXBqBskY.js";import{a as re}from"./Notification-DknLxsAA.js";import{h as ne}from"./import-history.service-DpiRdG1n.js";import{h as ce}from"./import-state.service-DAgDPWBr.js";import{F as V}from"./index-BhRCdEkM.js";import{S as K,C as de,F as G}from"./Table-DpT6Gmi_.js";import{U as xe}from"./index-gw_cWivs.js";import{I as me}from"./index-COXx4nht.js";import{D as _}from"./index-BnPBKEqo.js";import{T as A}from"./index-D0REtKkC.js";import{M as O}from"./index-Bm4Gcu65.js";import{L as he}from"./index-B9Cmd6z0.js";import"./row-C6zbN9W4.js";import"./DownOutlined-DNPPQBS5.js";import"./fade-CKahfaYX.js";import"./progress-Db9LDLvQ.js";const P=()=>{const i=r.useContext(W);if(i===null)throw new Error("useVehicle must be used within a VehicleProvider");return i},fe=({onClose:i})=>{const f=H(o=>o.session),{vehicle:c}=P(),[m,N]=r.useState(!1),[w,I]=r.useState([]),b=async o=>{var n,p,u;N(!0);const y={...o,visible_cliente:o.visible_cliente??!1,file:(p=(n=o.archivo)==null?void 0:n[0])==null?void 0:p.originFileObj,id_usuario:f.id_sesion,id_cliente:(u=c.cotizacion.cliente)==null?void 0:u.id_cliente};ne(c.id_vehiculo,y).then(d=>{h[d.success?"success":"warning"](d.message),d.success&&i()}).catch(d=>h.error(`Error http import history evidence: ${d.message}`)).finally(()=>N(!1))},x=o=>Array.isArray(o)?o:o==null?void 0:o.fileList;return r.useEffect(()=>{ce().then(o=>I(o)).catch(o=>h.error(`Error http get import state ${o.message}`))},[]),e.jsxs(V,{layout:"vertical",name:"evidence",onFinish:b,initialValues:{id_estado_importacion:c.estado_importacion.id_estado_importacion},children:[e.jsx(V.Item,{tooltip:"Permite cambiar el estado de la importaciÃ³n",label:"Estado",name:"id_estado_importacion",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(K,{placeholder:"Seleccione un estado",options:w.map(o=>({label:o.estado_importacion,value:o.id_estado_importacion}))})}),e.jsx(V.Item,{label:"Archivo",name:"archivo",valuePropName:"fileList",getValueFromEvent:x,rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(xe,{accept:".png, .jpg, .jpeg, .tif, .tiff, .pdf",onChange:o=>o.file.status="done",customRequest:()=>{},listType:"picture-card",onPreview:()=>{},maxCount:1,children:e.jsxs("button",{style:{border:0,background:"none"},type:"button",children:[e.jsx(v.Plus,{}),e.jsx("div",{style:{marginTop:8},children:"Cargar"})]})})}),e.jsx(V.Item,{label:"Descripcion",name:"descripcion",rules:[{required:!0,message:"El campo es obligatorio"}],children:e.jsx(me.TextArea,{rows:3})}),e.jsx(V.Item,{label:"Visible por el cliente",name:"visible_cliente",valuePropName:"checked",children:e.jsx(de,{})}),e.jsx("div",{className:"text-right",children:e.jsx(g,{type:"primary",htmlType:"submit",disabled:m,loading:m,children:"Enviar"})})]})},Y=({detail:i})=>e.jsx(G,{size:"small",rowClassName:(f,c)=>c%2===0?"table-row-light":"table-row-dark",pagination:!1,showSorterTooltip:!1,rowKey:"id_subasta",dataSource:i,columns:[{title:"Concepto",dataIndex:"nombre",ellipsis:!0},{width:200,title:"Valor",render:(f,{moneda:c,valor:m})=>e.jsxs("span",{children:[c,". ",X(m)]})}]}),pe=()=>{var p,u,d,z,E,F,C,T,t,s,a,j,D,R;const{vehicle:i,updateVehicle:f}=P(),[c,m]=r.useState({view:!1,evidence:!1}),[N,w]=r.useState(L),[I,b]=r.useState(!1),x=(l,S=!0)=>m({...c,[l]:S}),o=l=>{w({...N,ruta:l}),x("view")},y=async()=>{var l,S,U;try{if(!((l=i.cotizacion.cliente)!=null&&l.correo))return h.warning("El cliente no cuenta con correo, por favor edite el cliente antes de generar la url");const M={id:(S=i.cotizacion.cliente)==null?void 0:S.id_cliente,correo:(U=i.cotizacion.cliente)==null?void 0:U.correo},Q=window.btoa(JSON.stringify(M)),J=`${window.location.href.split("#")[0]}#/${Z.SING_IN_CUSTOMER}/${Q}`;await re(J),h.success("Copiado el url al portapapeles")}catch(M){h.error(`Ha ocurrido un error: ${M}`)}},n=()=>{b(!0),se(i.id_vehiculo).then(l=>f(l)).catch(l=>h.error(`Error http get vehicles: ${l.message}`)).finally(()=>b(!1))};return r.useEffect(()=>{n()},[]),e.jsxs("div",{className:"flex flex-column",children:[e.jsxs("div",{className:"flex flex-row gap-3 mb-3",children:[e.jsxs("div",{className:"flex flex-column flex-1 px-3",children:[e.jsx(_,{orientation:"left",children:"Informacion del cliente"}),e.jsxs("div",{className:"flex flex-column",children:[e.jsx("strong",{children:"Cliente:"}),e.jsx("div",{className:"text-decoration",children:(p=i.cotizacion.cliente)==null?void 0:p.cliente})]}),e.jsxs("div",{className:"flex flex-row gap-3 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-column",children:[e.jsx("strong",{children:"Telefono Fijo:"}),e.jsx("div",{className:"text-decoration",children:(u=i.cotizacion.cliente)==null?void 0:u.telefono_fijo})]}),e.jsxs("div",{className:"flex flex-1 flex-column",children:[e.jsx("strong",{children:"Telefono Celular:"}),e.jsx("div",{className:"text-decoration",children:(d=i.cotizacion.cliente)==null?void 0:d.telefono_celular})]})]}),e.jsxs("div",{className:"flex flex-column",children:[e.jsx("strong",{children:"Direccion:"}),e.jsx("div",{className:"text-decoration",children:(z=i.cotizacion.cliente)==null?void 0:z.direccion})]}),e.jsxs("div",{className:"flex flex-row gap-3 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-column",children:[e.jsx("strong",{children:"No. NIT:"}),e.jsx("div",{className:"text-decoration",children:(E=i.cotizacion.cliente)==null?void 0:E.nit})]}),e.jsxs("div",{className:"flex flex-1 flex-column",children:[e.jsx("strong",{children:"No. DPI:"}),e.jsx("div",{className:"text-decoration",children:(F=i.cotizacion.cliente)==null?void 0:F.dpi})]})]}),e.jsxs("div",{className:"flex flex-column",children:[e.jsx("strong",{children:"Correo:"}),e.jsx("div",{className:"text-decoration",children:(C=i.cotizacion.cliente)==null?void 0:C.correo})]})]}),e.jsxs("div",{className:"flex flex-column flex-1",children:[e.jsx(_,{orientation:"left",children:"Informacion del vehiculo"}),e.jsxs("div",{className:"flex flex-row gap-3 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-column",children:[e.jsx("strong",{children:"No. VIN:"}),e.jsx("div",{className:"text-decoration",children:i.cotizacion.vin})]}),e.jsxs("div",{className:"flex flex-1 flex-column",children:[e.jsx("strong",{children:"No. Lote:"}),e.jsx("div",{className:"text-decoration",children:i.cotizacion.lote})]})]}),e.jsxs("div",{className:"flex  flex-row gap-3 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-column",children:[e.jsx("strong",{children:"Tipo de vehiculo:"}),e.jsx("div",{className:"text-decoration",children:(T=i.cotizacion.tipo_veniculo)==null?void 0:T.tipo_vehiculo})]}),e.jsxs("div",{className:"flex flex-1 flex-column",children:[e.jsx("strong",{children:"Marca y modelo:"}),e.jsxs("div",{className:"text-decoration",children:[i.cotizacion.marca," - ",i.cotizacion.modelo]})]})]}),e.jsx(_,{orientation:"left",children:"Informacion del vendedor"}),e.jsxs("div",{className:"flex flex-column",children:[e.jsx("strong",{children:"Nombre:"}),e.jsx("div",{className:"text-decoration",children:(t=i.cotizacion.vendedor)==null?void 0:t.nombre})]}),e.jsxs("div",{className:"flex flex-row gap-3 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-column",children:[e.jsx("strong",{children:"Telefono:"}),e.jsx("div",{className:"text-decoration",children:(s=i.cotizacion.vendedor)==null?void 0:s.telefono})]}),e.jsxs("div",{className:"flex flex-1 flex-column",children:[e.jsx("strong",{children:"Correo:"}),e.jsx("div",{className:"text-decoration",children:(a=i.cotizacion.vendedor)==null?void 0:a.correo})]})]})]})]}),e.jsxs("div",{className:"flex  mb-3 px-5 gap-3",children:[((j=i.cotizacion.detalles)==null?void 0:j.some(l=>l.moneda===k.USD))&&e.jsxs("div",{className:"flex-1",children:[e.jsx(_,{orientation:"left",children:"Detalle en USD"}),e.jsx(Y,{detail:i.cotizacion.detalles.filter(l=>l.moneda===k.USD)??[]})]}),((D=i.cotizacion.detalles)==null?void 0:D.some(l=>l.moneda===k.GTQ))&&e.jsxs("div",{className:"flex-1",children:[e.jsx(_,{orientation:"left",children:"Detalle en GTQ"}),e.jsx(Y,{detail:((R=i.cotizacion.detalles)==null?void 0:R.filter(l=>l.moneda===k.GTQ))??[]})]})]}),e.jsx(_,{orientation:"left",children:"Historico"}),e.jsx(G,{size:"small",rowClassName:(l,S)=>S%2===0?"table-row-light":"table-row-dark",pagination:!1,className:"table mb-3 px-5",showSorterTooltip:!1,rowKey:"id_subasta",dataSource:i.historial_vechiculo,loading:I,scroll:{y:250},columns:[{title:"Fecha",dataIndex:"fecha_creacion",render:l=>e.jsx("span",{children:q(l,"DD/MM/YYYY HH:mm")})},{title:"Descripcion",dataIndex:"descripcion",ellipsis:!0},{title:"Visible por el cliente",dataIndex:"visible_cliente",align:"center",render:l=>e.jsx(A,{color:l?"green":"red",children:l?"Si":"No"})},{title:"archivo",dataIndex:"archivo",render:l=>e.jsx("div",{className:"text-center",children:l&&e.jsx(B,{title:"Ver",placement:"right",children:e.jsx(g,{type:"link",icon:e.jsx(v.Eye,{}),onClick:()=>o(l)})})})}]}),e.jsxs("div",{className:"flex  flex-row gap-3 justify-end",children:[e.jsx(g,{type:"link",htmlType:"button",icon:e.jsx(v.Copy,{}),onClick:y,children:"Url Cliente"}),e.jsx(g,{type:"primary",icon:e.jsx(v.ArrowsExchange,{}),htmlType:"button",onClick:()=>x("evidence"),children:"Evidencia | Estado"})]}),e.jsx(O,{open:c.view,onCancel:()=>{x("view",!1),w(L)},centered:!0,destroyOnClose:!0,closeIcon:e.jsx("div",{className:"bg-secondary px-2 border-sm",children:e.jsx(v.Close,{color:"white"})}),width:1e3,footer:!1,className:"bg-transparent",children:e.jsx(ae,{file:N,download:!0})}),e.jsx(O,{open:c.evidence,title:e.jsx("h3",{children:"Cargar evidencia | Cambiar estado"}),footer:null,centered:!0,destroyOnClose:!0,onCancel:()=>x("evidence",!1),children:e.jsx(fe,{onClose:()=>{x("evidence",!1),n()}})})]})},Pe=()=>{const i=H(t=>t.device),{lote:f}=ee(),c=te(),{vehicle:m,addVehicle:N}=P(),[w,I]=r.useState([]),[b,x]=r.useState([]),[o,y]=r.useState(!1),[n,p]=r.useState({pagination:{current:1,pageSize:250}}),[u,d]=r.useState(""),[z,E]=r.useState(!1),F=(t,s,a)=>{var j;p({pagination:t,filters:s,sortOrder:Array.isArray(a)?void 0:a.order,sortField:Array.isArray(a)?void 0:a.field}),t.pageSize!==((j=n.pagination)==null?void 0:j.pageSize)&&x([])},C=t=>{N(t),E(!0)},T=()=>{var t,s;y(!0),le({...n,current:(t=n.pagination)==null?void 0:t.current,pageSize:(s=n.pagination)==null?void 0:s.pageSize,filter:u,sortOrder:n.sortOrder==="descend"?"DESC":"ASC"}).then(a=>{if(x(a.data),p({...n,pagination:{...n.pagination,total:a.total}}),f){const j=a.data.find(D=>D.cotizacion.lote===f);j&&C(j),c(`/${$.PRIVATE}/${$.VEHICLES}`,{replace:!0})}}).catch(a=>h.error(`Error http get vehicles: ${a.message}`)).finally(()=>y(!1))};return r.useEffect(()=>{ie().then(t=>I(t==null?void 0:t.filter(s=>s.estado))).catch(t=>h.error(`Error http get customers: ${t.message}}`))},[]),r.useEffect(()=>{T()},[JSON.stringify(n),u]),e.jsxs("div",{className:"h-100 flex flex-column p-3",children:[e.jsxs("div",{className:"flex flex-md-column gap-3 justify-between items-end mb-3",children:[e.jsxs("div",{className:"flex flex-column w-md-100",children:[e.jsx("label",{htmlFor:"cliente",children:"Cliente"}),e.jsx(K,{placeholder:"Selecciones una opciÃ³n",options:w.filter(t=>t.estado).map(t=>({label:t.cliente,value:t.id_cliente})),onChange:t=>d(t),allowClear:!0,style:{minWidth:200}})]}),e.jsxs("div",{className:"flex flex-row gap-2 items-center w-md-100",children:[e.jsx(B,{title:"Recargar",children:e.jsx(g,{type:"text",htmlType:"button",icon:e.jsx(v.Reload,{}),onClick:()=>T()})}),e.jsx(oe,{onSearch:t=>d(t),onReset:()=>d("")})]}),e.jsx(g,{type:"primary",htmlType:"button",onClick:()=>{},className:"w-md-100",children:"Agregar"})]}),i?e.jsx(he,{dataSource:b,loading:o,renderItem:t=>{var s,a;return e.jsxs("div",{className:"item-list",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Cliente: "}),"Â ",(s=t.cotizacion.cliente)==null?void 0:s.cliente]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Vendedor: "}),"Â ",(a=t.cotizacion.vendedor)==null?void 0:a.nombre]}),e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Estado: "}),"Â ",t.estado?"Activo":"Inactivo"]}),e.jsx(g,{type:"link",danger:!0,htmlType:"button",icon:e.jsx(v.Edit,{}),onClick:()=>C(t),children:"Editar"})]})]},t.id_vehiculo)}}):e.jsx(G,{size:"small",rowClassName:(t,s)=>s%2===0?"table-row-light":"table-row-dark",pagination:{position:["none","bottomRight"],...n.pagination,showSizeChanger:!0,pageSizeOptions:[50,100,250,500]},onChange:F,className:"table",loading:o,showSorterTooltip:!1,rowKey:"id_vehiculo",dataSource:b,columns:[{title:"No",dataIndex:"id_vehiculo",sorter:!0},{title:"Fecha",dataIndex:"fecha_creacion",ellipsis:!0,sorter:!0,render:t=>e.jsx("span",{children:q(t,"DD/MM/YYYY")})},{title:"Loter",dataIndex:"lote",ellipsis:!0,sorter:!0,render:(t,{cotizacion:s})=>e.jsx("span",{children:s==null?void 0:s.lote})},{title:"Vendedor",dataIndex:"vendedor",ellipsis:!0,sorter:!0,render:(t,{cotizacion:s})=>{var a;return e.jsx("span",{children:(a=s==null?void 0:s.vendedor)==null?void 0:a.nombre})}},{title:"Cliente",dataIndex:"cliente",ellipsis:!0,sorter:!0,render:(t,{cotizacion:s})=>{var a;return e.jsx("span",{children:(a=s==null?void 0:s.cliente)==null?void 0:a.cliente})}},{title:"Marca y Modelo",dataIndex:"cotizacion",ellipsis:!0,render:t=>e.jsxs("span",{children:[t.marca," - ",t.modelo]})},{title:"Estado",dataIndex:"estado_importacion",sorter:!0,render:t=>e.jsx(A,{color:t.color,children:t.estado_importacion})},{title:"Opciones",dataIndex:"operacion",width:80,render:(t,s)=>e.jsx(g,{style:{width:40},icon:e.jsx(v.Edit,{}),type:"text",size:"small",onClick:()=>C(s),children:"Ver"})}]}),e.jsx(O,{open:z,title:e.jsxs("h3",{children:["Vehiculo ",e.jsx(A,{color:m.estado_importacion.color,children:m.estado_importacion.estado_importacion})]}),footer:null,onCancel:()=>E(!1),centered:!0,destroyOnClose:!0,width:1200,children:e.jsx(pe,{})})]})};export{Pe as Vehicles};
